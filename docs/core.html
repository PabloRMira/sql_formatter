---

title: core


keywords: fastai
sidebar: home_sidebar

summary: "Core functions for SQL formatting"
description: "Core functions for SQL formatting"
nb_path: "nbs/00_core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="General-helper-functions">General helper functions<a class="anchor-link" href="#General-helper-functions"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="assert_and_print" class="doc_header"><code>assert_and_print</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>assert_and_print</code>(<strong><code>s_in</code></strong>, <strong><code>s_expected</code></strong>)</p>
</blockquote>
<p>Assert equality of <code>s_in</code> and <code>s_expected</code> and print the result of <code>s_in</code> if the assertion worked</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1&quot;</span><span class="p">,</span> <span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf
from table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="General-formatting">General formatting<a class="anchor-link" href="#General-formatting"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Basic formatting for SQL queries. Let's use an example throughout the core module.</p>
<p>This is how an input could look like</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace table mytable as -- Mytable example</span>
<span class="s2">seLecT a.asdf, b.qwer, -- some comment here</span>
<span class="s2">/* and here is a line comment inside select */</span>
<span class="s2">c.asdf, -- some commenT there</span>
<span class="s2">case when a.asdf= 1 then &#39;b&#39; /* here a case comment */</span>
<span class="s2">when b.qwer =2 then &#39;c&#39; else &#39;d&#39; end as new_field, -- Some comment</span>
<span class="s2">b.asdf2 frOm table1 as a leFt join </span>
<span class="s2">table2 as b -- and here a comment</span>
<span class="s2">    on a.asdf = b.asdf  /* joiN this way */</span>
<span class="s2">    inner join table3 as c</span>
<span class="s2">on a.asdf=c.asdf</span>
<span class="s2">whEre a.asdf= 1 -- comment this</span>
<span class="s2">anD b.qwer =2 and a.asdf&lt;=1 --comment that</span>
<span class="s2">or b.qwer&gt;=5</span>
<span class="s2">groUp by a.asdf</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and this is how we would like to format it</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;CREATE OR REPLACE TABLE mytable AS -- Mytable example</span>
<span class="s2">SELECT a.asdf,</span>
<span class="s2">       b.qwer, -- some comment here</span>
<span class="s2">       /* and here is a line comment inside select */</span>
<span class="s2">       c.asdf, -- some commenT there</span>
<span class="s2">       case when a.asdf = 1 then &#39;b&#39; /* here a case comment */</span>
<span class="s2">            when b.qwer = 2 then &#39;c&#39;</span>
<span class="s2">            else &#39;d&#39; end as new_field, -- Some comment</span>
<span class="s2">       b.asdf2</span>
<span class="s2">FROM   table1 as a</span>
<span class="s2">    LEFT JOIN table2 as b -- and here a comment</span>
<span class="s2">        ON a.asdf = b.asdf /* joiN this way */</span>
<span class="s2">    INNER JOIN table3 as c</span>
<span class="s2">        ON a.asdf = c.asdf</span>
<span class="s2">WHERE  a.asdf = 1 -- comment this</span>
<span class="s2">   and b.qwer = 2</span>
<span class="s2">   and a.asdf &lt;= 1 --comment that</span>
<span class="s2">    or b.qwer &gt;= 5</span>
<span class="s2">GROUP BY a.asdf;&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's start by defining the main statements. The main statements all require a new line and should be in upper case</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to remove newlines and multiple spaces because the may be arbitrary</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="remove_newlines_mspaces" class="doc_header"><code>remove_newlines_mspaces</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L45" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>remove_newlines_mspaces</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Remove newline and too many spaces characters.
Newline characters in SELECT statement with comments
are replaced by special token [EOC] (end of comment)
because otherwise we cannot format SELECT statements
with comments properly</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">remove_newlines_mspaces</span><span class="p">(</span><span class="n">example_sql</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>create or replace table mytable as -- Mytable example[EOC]seLecT a.asdf, b.qwer, -- some comment here[EOC]/* and here is a line comment inside select */[EOC]c.asdf, -- some commenT there[EOC]case when a.asdf= 1 then &#39;b&#39; /* here a case comment */[EOC]when b.qwer =2 then &#39;c&#39; else &#39;d&#39; end as new_field, -- Some comment[EOC]b.asdf2 frOm table1 as a leFt join table2 as b -- and here a comment[EOC]on a.asdf = b.asdf /* joiN this way */[EOC]inner join table3 as c on a.asdf=c.asdf whEre a.asdf= 1 -- comment this[EOC]anD b.qwer =2 and a.asdf&lt;=1 --comment that[EOC]or b.qwer&gt;=5 groUp by a.asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_newlines_mspaces</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT asdf, qwer,</span>
<span class="sd"> qwer1,    qwer2</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="s2">&quot;SELECT asdf, qwer, qwer1, qwer2 FROM table1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer, qwer1, qwer2 FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With usual comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_newlines_mspaces</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf, qwer, -- some comment</span>
<span class="s2"> qwer1,    qwer2</span>
<span class="s2">FROM table1</span>
<span class="s2">WHERE asdf=1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;SELECT asdf, qwer, -- some comment[EOC]qwer1, qwer2 FROM table1 WHERE asdf=1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer, -- some comment[EOC]qwer1, qwer2 FROM table1 WHERE asdf=1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With other comment form</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_newlines_mspaces</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf, qwer, /*  another comment */</span>
<span class="s2">qwer1,    qwer2</span>
<span class="s2">FROM table1</span>
<span class="s2">WHERE asdf=1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;SELECT asdf, qwer, /* another comment */[EOC]qwer1, qwer2 FROM table1 WHERE asdf=1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer, /* another comment */[EOC]qwer1, qwer2 FROM table1 WHERE asdf=1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we would like to have each main statement in a separate line and in uppercase. The function below get somewhat convoluted because we have to take care of not formatting main statements in the comments like /<em> comment inside <strong>select</strong> </em>/</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="preformat_statement" class="doc_header"><code>preformat_statement</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L74" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>preformat_statement</code>(<strong><code>s</code></strong>, <strong><code>statements</code></strong>)</p>
</blockquote>
<p>Write a newline in <code>s</code> for all <code>statements</code> and
uppercase them but not if they are inside a comment</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statement</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer as new_var from table1 where asdf = 1&quot;</span><span class="p">,</span> <span class="n">MAIN_STATEMENTS</span><span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SELECT asdf, qwer as new_var</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
SELECT asdf, qwer as new_var
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">preformat_statement</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">seLect asdf,</span>
<span class="s2">       /* some comment inside select */</span>
<span class="s2">       qwer</span>
<span class="s2">From   table1 where  asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">MAIN_STATEMENTS</span><span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SELECT asdf, /* some comment inside select */[EOC]qwer</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
SELECT asdf, /* some comment inside select */[EOC]qwer
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">preformat_statement</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace view my_view as</span>
<span class="s2">seLect asdf,</span>
<span class="s2">       /* some comment inside select */</span>
<span class="s2">       qwer</span>
<span class="s2">From   table1 where  asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">MAIN_STATEMENTS</span><span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">CREATE OR REPLACE VIEW my_view AS</span><span class="se">\n</span><span class="s2">SELECT asdf, /* some comment inside select */[EOC]qwer</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE OR REPLACE VIEW my_view AS
SELECT asdf, /* some comment inside select */[EOC]qwer
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">preformat_statement</span><span class="p">(</span><span class="n">example_sql</span><span class="p">,</span> <span class="n">MAIN_STATEMENTS</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE OR REPLACE TABLE mytable AS -- Mytable example[EOC]
SELECT a.asdf, b.qwer, -- some comment here[EOC]/* and here is a line comment inside select */[EOC]c.asdf, -- some commenT there[EOC]case when a.asdf= 1 then &#39;b&#39; /* here a case comment */[EOC]when b.qwer =2 then &#39;c&#39; else &#39;d&#39; end as new_field, -- Some comment[EOC]b.asdf2
FROM table1 as a
LEFT JOIN table2 as b -- and here a comment[EOC]
ON a.asdf = b.asdf /* joiN this way */[EOC]
INNER JOIN table3 as c
ON a.asdf=c.asdf
WHERE a.asdf= 1 -- comment this[EOC]anD b.qwer =2 and a.asdf&lt;=1 --comment that[EOC]or b.qwer&gt;=5
GROUP BY a.asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We would like to have every non capital statement lower cased but let comments untouched</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lowercase_query" class="doc_header"><code>lowercase_query</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L103" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lowercase_query</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Lowercase query but let comments untouched</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">lowercase_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">--- My nice view 1 --</span>
<span class="s2">Create or Replace VieW view_1 as</span>
<span class="s2">seLect asdf, -- Some Comment</span>
<span class="s2">qwER,</span>
<span class="s2">qwerTy, -- Some other comment</span>
<span class="s2">FROM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">--- My nice view 1 --</span>
<span class="sd">create or replace view view_1 as</span>
<span class="sd">select asdf, -- Some Comment</span>
<span class="sd">qwer,</span>
<span class="sd">qwerty, -- Some other comment</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
--- My nice view 1 --
create or replace view view_1 as
select asdf, -- Some Comment
qwer,
qwerty, -- Some other comment
from table1

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">lowercase_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">-- Some comment --</span>
<span class="s2">Create Or rePlace tablE aS</span>
<span class="s2">sElEct asdf,</span>
<span class="s2">/* sOme CommEnt */</span>
<span class="s2">qwer</span>
<span class="s2">FroM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">-- Some comment --</span>
<span class="sd">create or replace table as</span>
<span class="sd">select asdf,</span>
<span class="sd">/* sOme CommEnt */</span>
<span class="sd">qwer</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
-- Some comment --
create or replace table as
select asdf,
/* sOme CommEnt */
qwer
from table1

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Specific-formatting-and-validation">Specific formatting and validation<a class="anchor-link" href="#Specific-formatting-and-validation"> </a></h2><p>Now we will format each statement individually</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Helper-function">Helper function<a class="anchor-link" href="#Helper-function"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_whitespaces_between_symbols" class="doc_header"><code>add_whitespaces_between_symbols</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L120" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_whitespaces_between_symbols</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Add whitespaces between symbols in line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_whitespaces_between_symbols</span><span class="p">(</span>
        <span class="s2">&quot;WHERE asdf= 1 and qwer=&gt;1 or blabla =&#39;asdf&#39;&quot;</span>
    <span class="p">),</span> <span class="s2">&quot;WHERE asdf = 1 and qwer =&gt; 1 or blabla = &#39;asdf&#39;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>WHERE asdf = 1 and qwer =&gt; 1 or blabla = &#39;asdf&#39;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SELECT">SELECT<a class="anchor-link" href="#SELECT"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_select" class="doc_header"><code>format_select</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L128" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_select</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format SELECT statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Simple usage without comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select aSdf, cast(qweR as numeric),  Asdf,qwer1&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select aSdf,</span><span class="se">\n</span><span class="s2">       cast(qweR as numeric),</span><span class="se">\n</span><span class="s2">       Asdf,</span><span class="se">\n</span><span class="s2">       qwer1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select aSdf,
       cast(qweR as numeric),
       Asdf,
       qwer1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>More advanced usage with comments in SELECT</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, cast(qwer as numeric), -- some comment[EOC]ASDF, qwer1&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select asdf,</span><span class="se">\n</span><span class="s2">       cast(qwer as numeric), -- some comment</span><span class="se">\n</span><span class="s2">       ASDF,</span><span class="se">\n</span><span class="s2">       qwer1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       cast(qwer as numeric), -- some comment
       ASDF,
       qwer1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Correcting common mistake on the flow: comma at end of SELECT</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1,   asdf,&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select qwer1,</span><span class="se">\n</span><span class="s2">       asdf&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Correcting comma at end of SELECT but having a comment in the last field</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1,   asdf, -- this field&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select qwer1,</span><span class="se">\n</span><span class="s2">       asdf -- this field&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       asdf -- this field
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1,   asdf, /* this field */&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select qwer1,</span><span class="se">\n</span><span class="s2">       asdf /* this field */&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       asdf /* this field */
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With <code>case when</code> conditions</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, case when abc = 1 then &#39;a&#39; when abc = 2 then &#39;b&#39; else &#39;c&#39; end as qwer2&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">       case when abc = 1 then &#39;a&#39;</span>
<span class="sd">            when abc = 2 then &#39;b&#39;</span>
<span class="sd">            else &#39;c&#39; end as qwer2</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       case when abc = 1 then &#39;a&#39;
            when abc = 2 then &#39;b&#39;
            else &#39;c&#39; end as qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, case when abc = 1 then &#39;a&#39; -- first condition[EOC]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;when abc = 2 then &#39;b&#39; -- second condition[EOC]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;else &#39;c&#39; end as qwer2, /* else condition */[EOC]&quot;</span>
                  <span class="s2">&quot;asdf3&quot;</span>
<span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">       case when abc = 1 then &#39;a&#39; -- first condition</span>
<span class="sd">            when abc = 2 then &#39;b&#39; -- second condition</span>
<span class="sd">            else &#39;c&#39; end as qwer2, /* else condition */</span>
<span class="sd">       asdf3</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       case when abc = 1 then &#39;a&#39; -- first condition
            when abc = 2 then &#39;b&#39; -- second condition
            else &#39;c&#39; end as qwer2, /* else condition */
       asdf3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Bad formatted <code>case when</code> condition</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, case when abc&lt;= 1 then &#39;a&#39; -- first condition[EOC]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;when abc=2 then &#39;b&#39; -- second condition[EOC]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;else &#39;c&#39; end as qwer2, -- else condition[EOC]&quot;</span>
                  <span class="s2">&quot;asdf3&quot;</span>
<span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">       case when abc &lt;= 1 then &#39;a&#39; -- first condition</span>
<span class="sd">            when abc = 2 then &#39;b&#39; -- second condition</span>
<span class="sd">            else &#39;c&#39; end as qwer2, -- else condition</span>
<span class="sd">       asdf3</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       case when abc &lt;= 1 then &#39;a&#39; -- first condition
            when abc = 2 then &#39;b&#39; -- second condition
            else &#39;c&#39; end as qwer2, -- else condition
       asdf3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="FROM">FROM<a class="anchor-link" href="#FROM"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_from" class="doc_header"><code>format_from</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L155" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_from</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format FROM statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">format_from</span><span class="p">(</span><span class="s2">&quot;from table1&quot;</span><span class="p">),</span> <span class="s2">&quot;from   table1&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>from   table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(LEFT-/-RIGHT-/-INNER-/-OUTER)-JOIN">(LEFT / RIGHT / INNER / OUTER) JOIN<a class="anchor-link" href="#(LEFT-/-RIGHT-/-INNER-/-OUTER)-JOIN"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_join" class="doc_header"><code>format_join</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L166" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_join</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format JOIN statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">format_join</span><span class="p">(</span><span class="s2">&quot;inner join table1&quot;</span><span class="p">),</span> <span class="s2">&quot;    inner join table1&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>    inner join table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="ON">ON<a class="anchor-link" href="#ON"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_on" class="doc_header"><code>format_on</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L172" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_on</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format ON statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">format_on</span><span class="p">(</span><span class="s2">&quot;on a.asdf =b.asdf&quot;</span><span class="p">),</span> <span class="s2">&quot;        on a.asdf = b.asdf&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>        on a.asdf = b.asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="WHERE">WHERE<a class="anchor-link" href="#WHERE"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_where" class="doc_header"><code>format_where</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L179" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_where</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format WHERE statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_where</span><span class="p">(</span>
        <span class="s2">&quot;WHERE asdf= 1 and qwer=1 or blabla =&#39;asdf&#39;&quot;</span>
    <span class="p">),</span> <span class="s2">&quot;WHERE  asdf = 1</span><span class="se">\n</span><span class="s2">   and qwer = 1</span><span class="se">\n</span><span class="s2">    or blabla = &#39;asdf&#39;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>WHERE  asdf = 1
   and qwer = 1
    or blabla = &#39;asdf&#39;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Format-all-statements">Format all statements<a class="anchor-link" href="#Format-all-statements"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_statement_line" class="doc_header"><code>format_statement_line</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L189" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_statement_line</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">format_statement_line</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       qwer
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">format_statement_line</span><span class="p">(</span><span class="s2">&quot;left join table1 as abc&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>    left join table1 as abc
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">format_statement_line</span><span class="p">(</span><span class="s2">&quot;where asdf=1 and qwer=&#39;things&#39; and blabla=0 or stuff=-1&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>where  asdf = 1
   and qwer = &#39;things&#39;
   and blabla = 0
    or stuff = -1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_statements" class="doc_header"><code>format_statements</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L207" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_statements</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format statements lines <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">format_statements</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer</span><span class="se">\n</span><span class="s2">from table1&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       qwer
from   table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Write-a-;-at-the-end-of-query">Write a ; at the end of query<a class="anchor-link" href="#Write-a-;-at-the-end-of-query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_ending_semicolon" class="doc_header"><code>add_ending_semicolon</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L217" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_ending_semicolon</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Add ending semicolon for SQL query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Basic usage</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_ending_semicolon</span><span class="p">(</span><span class="s2">&quot;select asdf from table1&quot;</span><span class="p">),</span> 
    <span class="s2">&quot;select asdf from table1;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf from table1;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Also works with multiple lines</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_ending_semicolon</span><span class="p">(</span><span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1</span><span class="se">\n</span><span class="s2">where asdf = 1&quot;</span><span class="p">),</span> 
    <span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1</span><span class="se">\n</span><span class="s2">where asdf = 1;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf
from table1
where asdf = 1;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It does not add another semicolon if there is already one there</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_ending_semicolon</span><span class="p">(</span><span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1</span><span class="se">\n</span><span class="s2">where asdf = 1;&quot;</span><span class="p">),</span> 
    <span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1</span><span class="se">\n</span><span class="s2">where asdf = 1;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf
from table1
where asdf = 1;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Putting-everything-together">Putting everything together<a class="anchor-link" href="#Putting-everything-together"> </a></h2><p>to format a simple query without subqueries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_simple_sql" class="doc_header"><code>format_simple_sql</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L225" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_simple_sql</code>(<strong><code>s</code></strong>, <strong><code>add_semicolon</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Format a simple SQL query without subqueries <code>s</code>.
If <code>add_semicolon</code> is True, then add a semicolon at the end</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_simple_sql</span><span class="p">(</span><span class="n">example_sql</span><span class="p">),</span>
    <span class="n">expected_sql</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE mytable AS -- Mytable example
SELECT a.asdf,
       b.qwer, -- some comment here
       /* and here is a line comment inside select */
       c.asdf, -- some commenT there
       case when a.asdf = 1 then &#39;b&#39; /* here a case comment */
            when b.qwer = 2 then &#39;c&#39;
            else &#39;d&#39; end as new_field, -- Some comment
       b.asdf2
FROM   table1 as a
    LEFT JOIN table2 as b -- and here a comment
        ON a.asdf = b.asdf /* joiN this way */
    INNER JOIN table3 as c
        ON a.asdf = c.asdf
WHERE  a.asdf = 1 -- comment this
   and b.qwer = 2
   and a.asdf &lt;= 1 --comment that
    or b.qwer &gt;= 5
GROUP BY a.asdf;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Queries-with-subqueries">Queries with subqueries<a class="anchor-link" href="#Queries-with-subqueries"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is how we could (badly) write a query with subqueries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_with_subqueries</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select asdf, cast(qwer as numeric), -- some comment</span>
<span class="s2">qwer1 /* some field */</span>
<span class="s2">from </span>
<span class="s2">(select asdf, qwer, /* some nice field */ from table1 where asdf = 1) as a</span>
<span class="s2">left </span>
<span class="s2">join (select asdf, qwer2 from table2 where qwer2 = 1) as b</span>
<span class="s2">on a.asdf = b.asdf</span>
<span class="s2">where qwer1 &gt;= 0</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">example_with_subqueries</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
select asdf, cast(qwer as numeric), -- some comment
qwer1 /* some field */
from 
(select asdf, qwer, /* some nice field */ from table1 where asdf = 1) as a
left 
join (select asdf, qwer2 from table2 where qwer2 = 1) as b
on a.asdf = b.asdf
where qwer1 &gt;= 0

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and this is the way we would like to have it nicely formatted</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_with_subqueries</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf,</span>
<span class="s2">       cast(qwer as numeric), -- some comment</span>
<span class="s2">       qwer1 /* some field */</span>
<span class="s2">FROM   (SELECT asdf,</span>
<span class="s2">               qwer /* some nice field */</span>
<span class="s2">        FROM   table1</span>
<span class="s2">        WHERE  asdf = 1) as a</span>
<span class="s2">    LEFT JOIN (SELECT asdf,</span>
<span class="s2">                      qwer2</span>
<span class="s2">               FROM   table2</span>
<span class="s2">               WHERE  qwer2 = 1) as b</span>
<span class="s2">        ON a.asdf = b.asdf</span>
<span class="s2">WHERE  qwer1 &gt;= 0;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Helper-functions-to-handle-subqueries">Helper functions to handle subqueries<a class="anchor-link" href="#Helper-functions-to-handle-subqueries"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_outer_subquery" class="doc_header"><code>extract_outer_subquery</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L238" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_outer_subquery</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Extract outer subquery in query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="p">(</span>
    <span class="n">extract_outer_subquery</span><span class="p">(</span>
        <span class="s2">&quot;() () (</span><span class="se">\n</span><span class="s2">SELECT () (</span><span class="se">\n</span><span class="s2">SELECT ())) ()&quot;</span>
    <span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_subquery" class="doc_header"><code>format_subquery</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L264" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_subquery</code>(<strong><code>s</code></strong>, <strong><code>previous_s</code></strong>)</p>
</blockquote>
<p>Format subquery in line <code>s</code> based on indentation on <code>previous_s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Main-function-handling-queries-with-subqueries">Main function handling queries with subqueries<a class="anchor-link" href="#Main-function-handling-queries-with-subqueries"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_sql" class="doc_header"><code>format_sql</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L289" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_sql</code>(<strong><code>s</code></strong>, <strong><code>add_semicolon</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Format SQL query with subqueries. If <code>add_semicolon</code> is True then add a semicolon at the end</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span><span class="n">example_with_subqueries</span><span class="p">),</span>
    <span class="n">expected_with_subqueries</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf,
       cast(qwer as numeric), -- some comment
       qwer1 /* some field */
FROM   (SELECT asdf,
               qwer /* some nice field */
        FROM   table1
        WHERE  asdf = 1) as a
    LEFT JOIN (SELECT asdf,
                      qwer2
               FROM   table2
               WHERE  qwer2 = 1) as b
        ON a.asdf = b.asdf
WHERE  qwer1 &gt;= 0;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It even works with simple queries without subqueries, therefore generalizing the <code>format_simple_sql()</code> function</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span><span class="n">example_sql</span><span class="p">),</span>
    <span class="n">expected_sql</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE mytable AS -- Mytable example
SELECT a.asdf,
       b.qwer, -- some comment here
       /* and here is a line comment inside select */
       c.asdf, -- some commenT there
       case when a.asdf = 1 then &#39;b&#39; /* here a case comment */
            when b.qwer = 2 then &#39;c&#39;
            else &#39;d&#39; end as new_field, -- Some comment
       b.asdf2
FROM   table1 as a
    LEFT JOIN table2 as b -- and here a comment
        ON a.asdf = b.asdf /* joiN this way */
    INNER JOIN table3 as c
        ON a.asdf = c.asdf
WHERE  a.asdf = 1 -- comment this
   and b.qwer = 2
   and a.asdf &lt;= 1 --comment that
    or b.qwer &gt;= 5
GROUP BY a.asdf;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Nested-subqueries">Nested subqueries<a class="anchor-link" href="#Nested-subqueries"> </a></h2><p>The function is also robust against nested subqueries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_nested_subqueries</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select asdf, qwer</span>
<span class="s2">from (select a.asdf</span>
<span class="s2">    from (select asdf, qwer from table2) as a</span>
<span class="s2">        inner join (select asdf, qwer from table3) as b</span>
<span class="s2">            on a.qwer = b.qwer</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_nested</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT asdf,</span>
<span class="s2">       qwer</span>
<span class="s2">FROM   (SELECT a.asdf</span>
<span class="s2">        FROM   (SELECT asdf,</span>
<span class="s2">                       qwer</span>
<span class="s2">                FROM   table2) as a</span>
<span class="s2">            INNER JOIN (SELECT asdf,</span>
<span class="s2">                               qwer</span>
<span class="s2">                        FROM   table3) as b</span>
<span class="s2">                ON a.qwer = b.qwer);&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span><span class="n">example_nested_subqueries</span><span class="p">),</span>
    <span class="n">expected_nested</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf,
       qwer
FROM   (SELECT a.asdf
        FROM   (SELECT asdf,
                       qwer
                FROM   table2) as a
            INNER JOIN (SELECT asdf,
                               qwer
                        FROM   table3) as b
                ON a.qwer = b.qwer);
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="More-convoluted-nested-subquery">More convoluted nested subquery<a class="anchor-link" href="#More-convoluted-nested-subquery"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_convoluted</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select asdf</span>
<span class="s2">from (</span>
<span class="s2">    select asdf, qwer, /* some comment */</span>
<span class="s2">    from (select a.asdf, b.qwer, --some comment</span>
<span class="s2">          from (select asdf </span>
<span class="s2">                from table1) as a </span>
<span class="s2">            right join (select qwer </span>
<span class="s2">                        from table2) as b</span>
<span class="s2">                on a.asdf = b.asdf)</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_convoluted</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT asdf</span>
<span class="s2">FROM   (SELECT asdf,</span>
<span class="s2">               qwer /* some comment */</span>
<span class="s2">        FROM   (SELECT a.asdf,</span>
<span class="s2">                       b.qwer --some comment</span>
<span class="s2">                FROM   (SELECT asdf</span>
<span class="s2">                        FROM   table1) as a</span>
<span class="s2">                    RIGHT JOIN (SELECT qwer</span>
<span class="s2">                                FROM   table2) as b</span>
<span class="s2">                        ON a.asdf = b.asdf));&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span><span class="n">example_convoluted</span><span class="p">),</span>
    <span class="n">expected_convoluted</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf
FROM   (SELECT asdf,
               qwer /* some comment */
        FROM   (SELECT a.asdf,
                       b.qwer --some comment
                FROM   (SELECT asdf
                        FROM   table1) as a
                    RIGHT JOIN (SELECT qwer
                                FROM   table2) as b
                        ON a.asdf = b.asdf));
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

