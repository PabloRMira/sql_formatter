---

title: core


keywords: fastai
sidebar: home_sidebar

summary: "Core functions for SQL formatting"
description: "Core functions for SQL formatting"
nb_path: "nbs/00_core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="General-formatting">General formatting<a class="anchor-link" href="#General-formatting"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Basic formatting for SQL queries. Let's use an example throughout the core module.</p>
<p>This is how an input could look like</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace table mytable as -- Mytable example</span>
<span class="s2">/* multi line</span>
<span class="s2">   comment */</span>
<span class="s2">seLecT a.asdf, b.qwer, -- some comment here</span>
<span class="s2">/* and here is a line comment inside select */</span>
<span class="s2">substr(c.asdf, 1, 2) as substr_asdf, </span>
<span class="s2">/* some commenT there */</span>
<span class="s2">case when a.asdf= 1 then &#39;b&#39; /* here a case comment */</span>
<span class="s2">when b.qwer =2 then &#39;c&#39; else &#39;d&#39; end as new_field, -- Some comment</span>
<span class="s2">b.asdf2 frOm table1 as a leFt join </span>
<span class="s2">table2 as b -- and here a comment</span>
<span class="s2">    on a.asdf = b.asdf  /* joiN this way */</span>
<span class="s2">    inner join table3 as c</span>
<span class="s2">on a.asdf=c.asdf and a.qwer= b.qwer</span>
<span class="s2">whEre a.asdf= 1 -- comment this</span>
<span class="s2">anD b.qwer =2 and a.asdf&lt;=1 --comment that</span>
<span class="s2">or b.qwer&gt;=5</span>
<span class="s2">groUp by a.asdf</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and this is how we would like to format it</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;CREATE OR REPLACE TABLE mytable AS -- Mytable example</span>
<span class="s2">/* multi line</span>
<span class="s2">comment */</span>
<span class="s2">SELECT a.asdf,</span>
<span class="s2">       b.qwer, -- some comment here</span>
<span class="s2">       /* and here is a line comment inside select */</span>
<span class="s2">       substr(c.asdf, 1, 2) as substr_asdf,</span>
<span class="s2">       /* some commenT there */</span>
<span class="s2">       case when a.asdf = 1 then &#39;b&#39; /* here a case comment */</span>
<span class="s2">            when b.qwer = 2 then &#39;c&#39;</span>
<span class="s2">            else &#39;d&#39; end as new_field, -- Some comment</span>
<span class="s2">       b.asdf2</span>
<span class="s2">FROM   table1 as a</span>
<span class="s2">    LEFT JOIN table2 as b -- and here a comment</span>
<span class="s2">        ON a.asdf = b.asdf /* joiN this way */</span>
<span class="s2">    INNER JOIN table3 as c</span>
<span class="s2">        ON a.asdf = c.asdf and</span>
<span class="s2">           a.qwer = b.qwer</span>
<span class="s2">WHERE  a.asdf = 1 -- comment this</span>
<span class="s2">   and b.qwer = 2</span>
<span class="s2">   and a.asdf &lt;= 1 --comment that</span>
<span class="s2">    or b.qwer &gt;= 5</span>
<span class="s2">GROUP BY a.asdf;&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's start by defining the main statements. The main statements all require a new line and should be in upper case</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Remark:For OVER we only capitalize without adding a newline</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to remove newlines and multiple spaces because the may be arbitrary.</p>
<p>Before removing newlines we also need to mark the end of coments because we would not know where they end</p>
<p>We also mark the begin of comments /<em> </em>/ if they are in a newline</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_query" class="doc_header"><code>clean_query</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L32" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_query</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Remove redundant whitespaces and mark comments boundaries and remove newlines afterwards in query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT asdf, qwer,</span>
<span class="sd"> qwer1,    qwer2</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="s2">&quot;SELECT asdf, qwer, qwer1, qwer2 FROM table1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer, qwer1, qwer2 FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With usual comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf, qwer, -- some comment</span>
<span class="s2"> qwer1,    qwer2</span>
<span class="s2">FROM table1</span>
<span class="s2">WHERE asdf=1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;SELECT asdf, qwer, -- some comment[C]qwer1, qwer2 FROM table1 WHERE asdf=1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer, -- some comment[C]qwer1, qwer2 FROM table1 WHERE asdf=1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With other comment form</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf, qwer, /*  another comment */</span>
<span class="s2">qwer1,    qwer2</span>
<span class="s2">FROM table1</span>
<span class="s2">WHERE asdf=1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;SELECT asdf, qwer, /* another comment */[C]qwer1, qwer2 FROM table1 WHERE asdf=1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer, /* another comment */[C]qwer1, qwer2 FROM table1 WHERE asdf=1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT asdf, qwer, /*  another comment */</span>
<span class="sd">qwer1,    </span>
<span class="sd">/* inline comment */</span>
<span class="sd">qwer2</span>
<span class="sd">FROM table1</span>
<span class="sd">WHERE asdf=1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span> 
    <span class="s2">&quot;SELECT asdf, qwer, /* another comment */[C]qwer1,[CS]/* inline comment */[C]qwer2 FROM table1 WHERE asdf=1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer, /* another comment */[C]qwer1,[CS]/* inline comment */[C]qwer2 FROM table1 WHERE asdf=1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace my_table as</span>
<span class="sd">/* some comment</span>
<span class="sd">   some new comment line */</span>
<span class="sd">select asdf,</span>
<span class="sd">qwer,   qwer2</span>

<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;create or replace my_table as[CS]/* some comment</span>
<span class="sd">some new comment line */[C]select asdf, qwer, qwer2 from table1&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>create or replace my_table as[CS]/* some comment
some new comment line */[C]select asdf, qwer, qwer2 from table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we would like to have each main statement (SELECT, FROM , ...) in a separate line and in uppercase, ignoring text in comments. Also for the special case with PARTITION BY in the SELECT statement we will not add a newline because the main statement in that case is SELECT and not PARTITION BY</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="preformat_statements" class="doc_header"><code>preformat_statements</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L43" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>preformat_statements</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Write a newline in <code>s</code> for all <code>statements</code> and
uppercase them but not if they are inside a comment</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer as new_var from table1 where asdf = 1&quot;</span><span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SELECT asdf, qwer as new_var</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
SELECT asdf, qwer as new_var
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">seLect asdf,</span>
<span class="s2">       /* some comment inside select */</span>
<span class="s2">       qwer</span>
<span class="s2">From   table1 where  asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SELECT asdf,[CS]/* some comment inside select */[C]qwer</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
SELECT asdf,[CS]/* some comment inside select */[C]qwer
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">seLect asdf, /* some comment inside select */</span>
<span class="s2">       qwer</span>
<span class="s2">From   table1 where  asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SELECT asdf, /* some comment inside select */[C]qwer</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
SELECT asdf, /* some comment inside select */[C]qwer
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace view my_view as</span>
<span class="s2">seLect asdf,</span>
<span class="s2">       /* some comment inside select */</span>
<span class="s2">       qwer</span>
<span class="s2">From   table1 where  asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">CREATE OR REPLACE VIEW my_view AS</span><span class="se">\n</span><span class="s2">SELECT asdf,[CS]/* some comment inside select */[C]qwer</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE OR REPLACE VIEW my_view AS
SELECT asdf,[CS]/* some comment inside select */[C]qwer
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace view my_view as</span>
<span class="s2">seLect asdf,</span>
<span class="s2">       qwer_function,</span>
<span class="s2">       qwer</span>
<span class="s2">From   table1 where  asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">CREATE OR REPLACE VIEW my_view AS</span><span class="se">\n</span><span class="s2">SELECT asdf, qwer_function, qwer</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE OR REPLACE VIEW my_view AS
SELECT asdf, qwer_function, qwer
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace view my_view as</span>
<span class="s2">seLect asdf, qwer_function,</span>
<span class="s2">       lead(asdf) over (Partition By asdf order BY qwer),</span>
<span class="s2">    qwer2</span>
<span class="s2">From   table1 where  asdf = 1 order by asdf</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE VIEW my_view AS</span>
<span class="sd">SELECT asdf, qwer_function, lead(asdf) OVER (PARTITION BY asdf ORDER BY qwer), qwer2</span>
<span class="sd">FROM table1</span>
<span class="sd">WHERE asdf = 1</span>
<span class="sd">ORDER BY asdf&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE OR REPLACE VIEW my_view AS
SELECT asdf, qwer_function, lead(asdf) OVER (PARTITION BY asdf ORDER BY qwer), qwer2
FROM table1
WHERE asdf = 1
ORDER BY asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace table mytable as -- Mytable example</span>
<span class="sd">seLecT a.asdf, b.qwer, -- some comment here</span>
<span class="sd">/* and here is a line comment inside select */</span>
<span class="sd">substr(c.asdf, 1, 2) as substr_asdf</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE mytable AS -- Mytable example[C]</span>
<span class="sd">SELECT a.asdf, b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]substr(c.asdf, 1, 2) as substr_asdf</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE OR REPLACE TABLE mytable AS -- Mytable example[C]
SELECT a.asdf, b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]substr(c.asdf, 1, 2) as substr_asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create table mytable as -- Mytable example</span>
<span class="sd">seLecT a.asdf, b.qwer, -- some comment here</span>
<span class="sd">/* and here is a line comment inside select */</span>
<span class="sd">substr(c.asdf, 1, 2) as substr_asdf</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE TABLE mytable AS -- Mytable example[C]</span>
<span class="sd">SELECT a.asdf, b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]substr(c.asdf, 1, 2) as substr_asdf</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE TABLE mytable AS -- Mytable example[C]
SELECT a.asdf, b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]substr(c.asdf, 1, 2) as substr_asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace table  my_table as -- mytable</span>
<span class="sd">select distinct asdf, qwer, -- some comment</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE my_table AS -- mytable[C]</span>
<span class="sd">SELECT DISTINCT asdf, qwer, -- some comment[C]</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE OR REPLACE TABLE my_table AS -- mytable[C]
SELECT DISTINCT asdf, qwer, -- some comment[C]
FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With additional keyword <code>COMMENT</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace table  my_table comment=&#39;blabla&#39; as -- mytable</span>
<span class="sd">select distinct asdf, qwer, -- some comment</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE my_table comment=&#39;blabla&#39; AS -- mytable[C]</span>
<span class="sd">SELECT DISTINCT asdf, qwer, -- some comment[C]</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE OR REPLACE TABLE my_table comment=&#39;blabla&#39; AS -- mytable[C]
SELECT DISTINCT asdf, qwer, -- some comment[C]
FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace transient table  my_table as -- mytable</span>
<span class="sd">select distinct asdf, qwer, -- some comment</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TRANSIENT TABLE my_table AS -- mytable[C]</span>
<span class="sd">SELECT DISTINCT asdf, qwer, -- some comment[C]</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE OR REPLACE TRANSIENT TABLE my_table AS -- mytable[C]
SELECT DISTINCT asdf, qwer, -- some comment[C]
FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Create view  my_table as -- mytable</span>
<span class="sd">select distinct asdf, qwer, -- some comment</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE VIEW my_table AS -- mytable[C]</span>
<span class="sd">SELECT DISTINCT asdf, qwer, -- some comment[C]</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE VIEW my_table AS -- mytable[C]
SELECT DISTINCT asdf, qwer, -- some comment[C]
FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">preformat_statements</span><span class="p">(</span><span class="n">example_sql</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CREATE OR REPLACE TABLE mytable AS -- Mytable example[C][CS]/* multi line
comment */[C]
SELECT a.asdf, b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]substr(c.asdf, 1, 2) as substr_asdf,[CS]/* some commenT there */[C]case when a.asdf= 1 then &#39;b&#39; /* here a case comment */[C]when b.qwer =2 then &#39;c&#39; else &#39;d&#39; end as new_field, -- Some comment[C]b.asdf2
FROM table1 as a
LEFT JOIN table2 as b -- and here a comment[C]
ON a.asdf = b.asdf /* joiN this way */[C]
INNER JOIN table3 as c
ON a.asdf=c.asdf and a.qwer= b.qwer
WHERE a.asdf= 1 -- comment this[C]anD b.qwer =2 and a.asdf&lt;=1 --comment that[C]or b.qwer&gt;=5
GROUP BY a.asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We would like to have every non capital statement lower cased but let comments and quoted text untouched</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lowercase_query" class="doc_header"><code>lowercase_query</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L82" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lowercase_query</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Lowercase query but let comments and text in quotes untouched</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">lowercase_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">--- My nice view 1 --</span>
<span class="s2">Create or Replace VieW view_1 as</span>
<span class="s2">seLect asdf, -- Some Comment</span>
<span class="s2">qwER,</span>
<span class="s2">qwerTy, -- Some other comment</span>
<span class="s2">FROM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">--- My nice view 1 --</span>
<span class="sd">create or replace view view_1 as</span>
<span class="sd">select asdf, -- Some Comment</span>
<span class="sd">qwer,</span>
<span class="sd">qwerty, -- Some other comment</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
--- My nice view 1 --
create or replace view view_1 as
select asdf, -- Some Comment
qwer,
qwerty, -- Some other comment
from table1

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">lowercase_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">-- Some comment --</span>
<span class="s2">Create Or rePlace tablE aS</span>
<span class="s2">sElEct asdf,</span>
<span class="s2">/* sOme CommEnt */</span>
<span class="s2">qwer</span>
<span class="s2">FroM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">-- Some comment --</span>
<span class="sd">create or replace table as</span>
<span class="sd">select asdf,</span>
<span class="sd">/* sOme CommEnt */</span>
<span class="sd">qwer</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
-- Some comment --
create or replace table as
select asdf,
/* sOme CommEnt */
qwer
from table1

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">lowercase_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">-- Some comment --</span>
<span class="s2">Create Or rePlace tablE aS</span>
<span class="s2">sElEct asdf, replace(&#39;J&#39;, &#39;N&#39;, Asdf2) as Asdf3</span>
<span class="s2">/* sOme CommEnt */</span>
<span class="s2">qwer</span>
<span class="s2">FroM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">-- Some comment --</span>
<span class="sd">create or replace table as</span>
<span class="sd">select asdf, replace(&#39;J&#39;, &#39;N&#39;, asdf2) as asdf3</span>
<span class="sd">/* sOme CommEnt */</span>
<span class="sd">qwer</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
-- Some comment --
create or replace table as
select asdf, replace(&#39;J&#39;, &#39;N&#39;, asdf2) as asdf3
/* sOme CommEnt */
qwer
from table1

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">lowercase_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">-- Some comment --</span>
<span class="s2">Create Or rePlace tablE aS</span>
<span class="s2">sElEct asdf, replace(&#39;J&#39;, &#39;N&#39;, Asdf2) as Asdf3</span>
<span class="s2">/* sOme CommEnt */</span>
<span class="s2">qwer</span>
<span class="s2">FroM table1 -- Some comment</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">-- Some comment --</span>
<span class="sd">create or replace table as</span>
<span class="sd">select asdf, replace(&#39;J&#39;, &#39;N&#39;, asdf2) as asdf3</span>
<span class="sd">/* sOme CommEnt */</span>
<span class="sd">qwer</span>
<span class="sd">from table1 -- Some comment</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
-- Some comment --
create or replace table as
select asdf, replace(&#39;J&#39;, &#39;N&#39;, asdf2) as asdf3
/* sOme CommEnt */
qwer
from table1 -- Some comment

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Specific-formatting-and-validation">Specific formatting and validation<a class="anchor-link" href="#Specific-formatting-and-validation"> </a></h2><p>Now we will format each statement individually</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="PARTITION-BY">PARTITION BY<a class="anchor-link" href="#PARTITION-BY"> </a></h4><p>Within SELECT</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_partition_by" class="doc_header"><code>format_partition_by</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L208" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_partition_by</code>(<strong><code>s</code></strong>, <strong><code>base_indentation</code></strong>)</p>
</blockquote>
<p>Format PARTITION BY line in SELECT (DISTINCT)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SELECT">SELECT<a class="anchor-link" href="#SELECT"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_select" class="doc_header"><code>format_select</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L235" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_select</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format SELECT statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Simple usage without comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select aSdf, cast(qweR as numeric),  Asdf,qwer1&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select aSdf,</span><span class="se">\n</span><span class="s2">       cast(qweR as numeric),</span><span class="se">\n</span><span class="s2">       Asdf,</span><span class="se">\n</span><span class="s2">       qwer1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select aSdf,
       cast(qweR as numeric),
       Asdf,
       qwer1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>More advanced usage with comments in SELECT</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, cast(qwer as numeric), -- some comment[C]ASDF, qwer1&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select asdf,</span><span class="se">\n</span><span class="s2">       cast(qwer as numeric), -- some comment</span><span class="se">\n</span><span class="s2">       ASDF,</span><span class="se">\n</span><span class="s2">       qwer1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       cast(qwer as numeric), -- some comment
       ASDF,
       qwer1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, cast(qwer as numeric), -- some comment[C]ASDF, qwer1&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select asdf,</span><span class="se">\n</span><span class="s2">       cast(qwer as numeric), -- some comment</span><span class="se">\n</span><span class="s2">       ASDF,</span><span class="se">\n</span><span class="s2">       qwer1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       cast(qwer as numeric), -- some comment
       ASDF,
       qwer1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Correcting common mistake on the flow: comma at end of SELECT</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1,   asdf,&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select qwer1,</span><span class="se">\n</span><span class="s2">       asdf&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;SELECT a.asdf, b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]qwer2&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT a.asdf,</span>
<span class="sd">       b.qwer, -- some comment here</span>
<span class="sd">       /* and here is a line comment inside select */</span>
<span class="sd">       qwer2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT a.asdf,
       b.qwer, -- some comment here
       /* and here is a line comment inside select */
       qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;SELECT a.asdf, [CS]/* and here is a line comment inside select */&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT a.asdf, </span>
<span class="sd">       /* and here is a line comment inside select */</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT a.asdf, 
       /* and here is a line comment inside select */
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Correcting comma at end of SELECT but having a comment in the last field</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1 as qwer2,   asdf as asdf3, -- this field&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select qwer1 as qwer2,</span><span class="se">\n</span><span class="s2">       asdf as asdf3 -- this field&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1 as qwer2,
       asdf as asdf3 -- this field
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1,   asdf, /* this field */&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select qwer1,</span><span class="se">\n</span><span class="s2">       asdf /* this field */&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       asdf /* this field */
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With <code>case when</code> conditions</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, case when abc = 1 then &#39;a&#39; when abc = 2 then &#39;b&#39; else &#39;c&#39; end as qwer2&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">       case when abc = 1 then &#39;a&#39;</span>
<span class="sd">            when abc = 2 then &#39;b&#39;</span>
<span class="sd">            else &#39;c&#39; end as qwer2</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       case when abc = 1 then &#39;a&#39;
            when abc = 2 then &#39;b&#39;
            else &#39;c&#39; end as qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, case when abc = 1 then &#39;a&#39; -- first condition[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;when abc = 2 then &#39;b&#39; -- second condition[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;else &#39;c&#39; end as qwer2, /* else condition */[C]&quot;</span>
                  <span class="s2">&quot;asdf3&quot;</span>
<span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">       case when abc = 1 then &#39;a&#39; -- first condition</span>
<span class="sd">            when abc = 2 then &#39;b&#39; -- second condition</span>
<span class="sd">            else &#39;c&#39; end as qwer2, /* else condition */</span>
<span class="sd">       asdf3</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       case when abc = 1 then &#39;a&#39; -- first condition
            when abc = 2 then &#39;b&#39; -- second condition
            else &#39;c&#39; end as qwer2, /* else condition */
       asdf3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Bad formatted <code>case when</code> condition</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, case when abc&lt;= 1 then &#39;a&#39; -- first condition[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;when abc=2 then &#39;b&#39; -- second condition[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;else &#39;c&#39; end as qwer2, -- else condition[C]&quot;</span>
                  <span class="s2">&quot;asdf3&quot;</span>
<span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">       case when abc &lt;= 1 then &#39;a&#39; -- first condition</span>
<span class="sd">            when abc = 2 then &#39;b&#39; -- second condition</span>
<span class="sd">            else &#39;c&#39; end as qwer2, -- else condition</span>
<span class="sd">       asdf3</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       case when abc &lt;= 1 then &#39;a&#39; -- first condition
            when abc = 2 then &#39;b&#39; -- second condition
            else &#39;c&#39; end as qwer2, -- else condition
       asdf3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With functions in SELECT</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select aSdf, substr(qweR, 2) as qwer,  Asdf,qwer1&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select aSdf,</span><span class="se">\n</span><span class="s2">       substr(qweR, 2) as qwer,</span><span class="se">\n</span><span class="s2">       Asdf,</span><span class="se">\n</span><span class="s2">       qwer1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select aSdf,
       substr(qweR, 2) as qwer,
       Asdf,
       qwer1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select car_id,</span>
<span class="sd">       avg(price) as avg_price,</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select car_id,</span>
<span class="sd">       avg(price) as avg_price</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select car_id,
       avg(price) as avg_price
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With function in SELECT and case when</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, cast(case when asdf = &#39;j&#39; then 1 else 0 end) as qwer2, qwer3&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">       cast(case when asdf = &#39;j&#39; then 1</span>
<span class="sd">                 else 0 end) as qwer2,</span>
<span class="sd">       qwer3</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       cast(case when asdf = &#39;j&#39; then 1
                 else 0 end) as qwer2,
       qwer3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, cast(substr(case when asdf = &#39;j&#39; then 1 else 0 end, 2, 1)) as qwer2, qwer3&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">       cast(substr(case when asdf = &#39;j&#39; then 1</span>
<span class="sd">                        else 0 end, 2, 1)) as qwer2,</span>
<span class="sd">       qwer3</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
       cast(substr(case when asdf = &#39;j&#39; then 1
                        else 0 end, 2, 1)) as qwer2,
       qwer3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With <code>SELECT DISTINCT</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select distinct asdf, qwer, qwer2,&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select distinct asdf,</span>
<span class="sd">                qwer,</span>
<span class="sd">                qwer2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select distinct asdf,
                qwer,
                qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With <code>PARTITION BY</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, lead(asdf) over (partition by qwer, asdf2 order by qwer2) as qwer3, qwerty,&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       lead(asdf) over (partition by qwer,</span>
<span class="sd">                                     asdf2</span>
<span class="sd">                        order by qwer2) as qwer3,</span>
<span class="sd">       qwerty</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       lead(asdf) over (partition by qwer,
                                     asdf2
                        order by qwer2) as qwer3,
       qwerty
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, lead(asdf) over (partition by asdf, qwer order by qwer), cast(qwer as numeric), -- some comment[C]ASDF, &quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       lead(asdf) over (partition by asdf,</span>
<span class="sd">                                     qwer</span>
<span class="sd">                        order by qwer),</span>
<span class="sd">       cast(qwer as numeric), -- some comment</span>
<span class="sd">       ASDF</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       lead(asdf) over (partition by asdf,
                                     qwer
                        order by qwer),
       cast(qwer as numeric), -- some comment
       ASDF
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, lead(asdf) over (partition by asdf, qwer order by qwer, qwer2), cast(qwer as numeric), -- some comment[C]ASDF, &quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       lead(asdf) over (partition by asdf,</span>
<span class="sd">                                     qwer</span>
<span class="sd">                        order by qwer, qwer2),</span>
<span class="sd">       cast(qwer as numeric), -- some comment</span>
<span class="sd">       ASDF</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       lead(asdf) over (partition by asdf,
                                     qwer
                        order by qwer, qwer2),
       cast(qwer as numeric), -- some comment
       ASDF
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, lead(asdf, 1, 2) OVER (PARTITION BY snr, qwer ORDER BY asdf, qwer)&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       lead(asdf, 1, 2) OVER (PARTITION BY snr,</span>
<span class="sd">                                           qwer</span>
<span class="sd">                              ORDER BY asdf, qwer)</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       lead(asdf, 1, 2) OVER (PARTITION BY snr,
                                           qwer
                              ORDER BY asdf, qwer)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select distinct asdf, lead(asdf) over (partition by asdf, qwer order by qwer), cast(qwer as numeric), -- some comment[C]ASDF, &quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select distinct asdf,</span>
<span class="sd">                lead(asdf) over (partition by asdf,</span>
<span class="sd">                                              qwer</span>
<span class="sd">                                 order by qwer),</span>
<span class="sd">                cast(qwer as numeric), -- some comment</span>
<span class="sd">                ASDF</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select distinct asdf,
                lead(asdf) over (partition by asdf,
                                              qwer
                                 order by qwer),
                cast(qwer as numeric), -- some comment
                ASDF
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="FROM">FROM<a class="anchor-link" href="#FROM"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_from" class="doc_header"><code>format_from</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L285" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_from</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format FROM statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">format_from</span><span class="p">(</span><span class="s2">&quot;from table1&quot;</span><span class="p">),</span> <span class="s2">&quot;from   table1&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>from   table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(LEFT-/-RIGHT-/-INNER-/-OUTER)-JOIN">(LEFT / RIGHT / INNER / OUTER) JOIN<a class="anchor-link" href="#(LEFT-/-RIGHT-/-INNER-/-OUTER)-JOIN"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_join" class="doc_header"><code>format_join</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L296" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_join</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format JOIN statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">format_join</span><span class="p">(</span><span class="s2">&quot;inner join table1&quot;</span><span class="p">),</span> <span class="s2">&quot;    inner join table1&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>    inner join table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="ON">ON<a class="anchor-link" href="#ON"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_on" class="doc_header"><code>format_on</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L302" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_on</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format ON statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">format_on</span><span class="p">(</span><span class="s2">&quot;on a.asdf =b.asdf&quot;</span><span class="p">),</span> <span class="s2">&quot;        on a.asdf = b.asdf&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>        on a.asdf = b.asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_on</span><span class="p">(</span><span class="s2">&quot;on a.asdf =b.asdf and a.qwer=b.qwer&quot;</span><span class="p">),</span> 
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        on a.asdf = b.asdf and</span>
<span class="sd">           a.qwer = b.qwer</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>        on a.asdf = b.asdf and
           a.qwer = b.qwer
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_on</span><span class="p">(</span><span class="s2">&quot;on a.asdf =b.asdf and a.qwer=b.qwer or a.qwer2= b.qwer2&quot;</span><span class="p">),</span> 
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        on a.asdf = b.asdf and</span>
<span class="sd">           a.qwer = b.qwer or</span>
<span class="sd">           a.qwer2 = b.qwer2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>        on a.asdf = b.asdf and
           a.qwer = b.qwer or
           a.qwer2 = b.qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="WHERE">WHERE<a class="anchor-link" href="#WHERE"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_where" class="doc_header"><code>format_where</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L312" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_where</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format WHERE statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_where</span><span class="p">(</span>
        <span class="s2">&quot;WHERE asdf= 1 and qwer=1 or blabla =&#39;asdf&#39;&quot;</span>
    <span class="p">),</span> <span class="s2">&quot;WHERE  asdf = 1</span><span class="se">\n</span><span class="s2">   and qwer = 1</span><span class="se">\n</span><span class="s2">    or blabla = &#39;asdf&#39;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>WHERE  asdf = 1
   and qwer = 1
    or blabla = &#39;asdf&#39;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Format-all-statements">Format all statements<a class="anchor-link" href="#Format-all-statements"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_statement_line" class="doc_header"><code>format_statement_line</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L322" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_statement_line</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_statement_line</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       qwer</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       qwer
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_statement_line</span><span class="p">(</span><span class="s2">&quot;left join table1 as abc&quot;</span><span class="p">),</span>
    <span class="s2">&quot;    left join table1 as abc&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>    left join table1 as abc
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_statement_line</span><span class="p">(</span><span class="s2">&quot;where asdf=1 and qwer=&#39;things&#39; and blabla=0 or stuff=-1&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">where  asdf = 1</span>
<span class="sd">   and qwer = &#39;things&#39;</span>
<span class="sd">   and blabla = 0</span>
<span class="sd">    or stuff = -1</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>where  asdf = 1
   and qwer = &#39;things&#39;
   and blabla = 0
    or stuff = -1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_statements" class="doc_header"><code>format_statements</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L340" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_statements</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format statements lines <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_statements</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer</span><span class="se">\n</span><span class="s2">from table1&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       qwer</span>
<span class="sd">from   table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       qwer
from   table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Write-a-;-at-the-end-of-query">Write a ; at the end of query<a class="anchor-link" href="#Write-a-;-at-the-end-of-query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_ending_semicolon" class="doc_header"><code>add_ending_semicolon</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L350" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_ending_semicolon</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Add ending semicolon for SQL query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Basic usage</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_ending_semicolon</span><span class="p">(</span><span class="s2">&quot;select asdf from table1&quot;</span><span class="p">),</span> 
    <span class="s2">&quot;select asdf from table1;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf from table1;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Also works with multiple lines</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_ending_semicolon</span><span class="p">(</span><span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1</span><span class="se">\n</span><span class="s2">where asdf = 1&quot;</span><span class="p">),</span> 
    <span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1</span><span class="se">\n</span><span class="s2">where asdf = 1;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf
from table1
where asdf = 1;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It does not add another semicolon if there is already one there</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_ending_semicolon</span><span class="p">(</span><span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1</span><span class="se">\n</span><span class="s2">where asdf = 1;&quot;</span><span class="p">),</span> 
    <span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1</span><span class="se">\n</span><span class="s2">where asdf = 1;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf
from table1
where asdf = 1;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Putting-everything-together">Putting everything together<a class="anchor-link" href="#Putting-everything-together"> </a></h2><p>to format a simple query without subqueries or <code>PARTITION BY</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_simple_sql" class="doc_header"><code>format_simple_sql</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L358" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_simple_sql</code>(<strong><code>s</code></strong>, <strong><code>add_semicolon</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Format a simple SQL query without subqueries <code>s</code>.
If <code>add_semicolon</code> is True, then add a semicolon at the end</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_simple_sql</span><span class="p">(</span><span class="n">example_sql</span><span class="p">),</span>
    <span class="n">expected_sql</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE mytable AS -- Mytable example
/* multi line
comment */
SELECT a.asdf,
       b.qwer, -- some comment here
       /* and here is a line comment inside select */
       substr(c.asdf, 1, 2) as substr_asdf,
       /* some commenT there */
       case when a.asdf = 1 then &#39;b&#39; /* here a case comment */
            when b.qwer = 2 then &#39;c&#39;
            else &#39;d&#39; end as new_field, -- Some comment
       b.asdf2
FROM   table1 as a
    LEFT JOIN table2 as b -- and here a comment
        ON a.asdf = b.asdf /* joiN this way */
    INNER JOIN table3 as c
        ON a.asdf = c.asdf and
           a.qwer = b.qwer
WHERE  a.asdf = 1 -- comment this
   and b.qwer = 2
   and a.asdf &lt;= 1 --comment that
    or b.qwer &gt;= 5
GROUP BY a.asdf;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_simple_sql</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace table first_table as -- my first table</span>
<span class="sd">select car_id,</span>
<span class="sd">       avg(price) as avg_price,</span>
<span class="sd">from first_view</span>
<span class="sd">group by car_id</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE first_table AS -- my first table</span>
<span class="sd">SELECT car_id,</span>
<span class="sd">       avg(price) as avg_price</span>
<span class="sd">FROM   first_view</span>
<span class="sd">GROUP BY car_id;</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE first_table AS -- my first table
SELECT car_id,
       avg(price) as avg_price
FROM   first_view
GROUP BY car_id;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Queries-with-subqueries">Queries with subqueries<a class="anchor-link" href="#Queries-with-subqueries"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is how we could (badly) write a query with subqueries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_with_subqueries</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select asdf, cast(qwer as numeric), -- some comment</span>
<span class="s2">substr(qwer1, 3, 2) as substr_qwer /* some field */</span>
<span class="s2">from </span>
<span class="s2">(select asdf, qwer, /* some nice field */ from table1 where asdf = 1) as a</span>
<span class="s2">left </span>
<span class="s2">join (select asdf, qwer2 from table2 where qwer2 = 1) as b</span>
<span class="s2">on a.asdf = b.asdf</span>
<span class="s2">where qwer1 &gt;= 0</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and this is the way we would like to have it nicely formatted</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_with_subqueries</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf,</span>
<span class="s2">       cast(qwer as numeric), -- some comment</span>
<span class="s2">       substr(qwer1, 3, 2) as substr_qwer /* some field */</span>
<span class="s2">FROM   (SELECT asdf,</span>
<span class="s2">               qwer /* some nice field */</span>
<span class="s2">        FROM   table1</span>
<span class="s2">        WHERE  asdf = 1) as a</span>
<span class="s2">    LEFT JOIN (SELECT asdf,</span>
<span class="s2">                      qwer2</span>
<span class="s2">               FROM   table2</span>
<span class="s2">               WHERE  qwer2 = 1) as b</span>
<span class="s2">        ON a.asdf = b.asdf</span>
<span class="s2">WHERE  qwer1 &gt;= 0;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Main-function-handling-queries-with-subqueries">Main function handling queries with subqueries<a class="anchor-link" href="#Main-function-handling-queries-with-subqueries"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_sql" class="doc_header"><code>format_sql</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/core.py#L373" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_sql</code>(<strong><code>s</code></strong>, <strong><code>add_semicolon</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Format SQL query with subqueries. If <code>add_semicolon</code> is True then add a semicolon at the end</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span><span class="n">example_with_subqueries</span><span class="p">),</span>
    <span class="n">expected_with_subqueries</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf,
       cast(qwer as numeric), -- some comment
       substr(qwer1, 3, 2) as substr_qwer /* some field */
FROM   (SELECT asdf,
               qwer /* some nice field */
        FROM   table1
        WHERE  asdf = 1) as a
    LEFT JOIN (SELECT asdf,
                      qwer2
               FROM   table2
               WHERE  qwer2 = 1) as b
        ON a.asdf = b.asdf
WHERE  qwer1 &gt;= 0;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It even works with simple queries without subqueries, therefore generalizing the <code>format_simple_sql()</code> function</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span><span class="n">example_sql</span><span class="p">),</span>
    <span class="n">expected_sql</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE mytable AS -- Mytable example
/* multi line
comment */
SELECT a.asdf,
       b.qwer, -- some comment here
       /* and here is a line comment inside select */
       substr(c.asdf, 1, 2) as substr_asdf,
       /* some commenT there */
       case when a.asdf = 1 then &#39;b&#39; /* here a case comment */
            when b.qwer = 2 then &#39;c&#39;
            else &#39;d&#39; end as new_field, -- Some comment
       b.asdf2
FROM   table1 as a
    LEFT JOIN table2 as b -- and here a comment
        ON a.asdf = b.asdf /* joiN this way */
    INNER JOIN table3 as c
        ON a.asdf = c.asdf and
           a.qwer = b.qwer
WHERE  a.asdf = 1 -- comment this
   and b.qwer = 2
   and a.asdf &lt;= 1 --comment that
    or b.qwer &gt;= 5
GROUP BY a.asdf;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Nested-subqueries">Nested subqueries<a class="anchor-link" href="#Nested-subqueries"> </a></h2><p>The function is also robust against nested subqueries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_nested_subqueries</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select asdf, qwer</span>
<span class="s2">from (select a.asdf,  lead(a.substr_qwer) over (partition by a.asdf, asdf2 order by qwer) as lead_qwerty</span>
<span class="s2">    from (select asdf, substr(qwer, 3, 2) as substr_qwer from table2) as a</span>
<span class="s2">        inner join (select asdf, qwer from table3) as b</span>
<span class="s2">            on a.qwer = b.qwer</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_nested</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT asdf,</span>
<span class="s2">       qwer</span>
<span class="s2">FROM   (SELECT a.asdf,</span>
<span class="s2">               lead(a.substr_qwer) OVER (PARTITION BY a.asdf,</span>
<span class="s2">                                                      asdf2</span>
<span class="s2">                                         ORDER BY qwer) as lead_qwerty</span>
<span class="s2">        FROM   (SELECT asdf,</span>
<span class="s2">                       substr(qwer, 3, 2) as substr_qwer</span>
<span class="s2">                FROM   table2) as a</span>
<span class="s2">            INNER JOIN (SELECT asdf,</span>
<span class="s2">                               qwer</span>
<span class="s2">                        FROM   table3) as b</span>
<span class="s2">                ON a.qwer = b.qwer);&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span><span class="n">example_nested_subqueries</span><span class="p">),</span>
    <span class="n">expected_nested</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf,
       qwer
FROM   (SELECT a.asdf,
               lead(a.substr_qwer) OVER (PARTITION BY a.asdf,
                                                      asdf2
                                         ORDER BY qwer) as lead_qwerty
        FROM   (SELECT asdf,
                       substr(qwer, 3, 2) as substr_qwer
                FROM   table2) as a
            INNER JOIN (SELECT asdf,
                               qwer
                        FROM   table3) as b
                ON a.qwer = b.qwer);
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="More-convoluted-nested-subquery">More convoluted nested subquery<a class="anchor-link" href="#More-convoluted-nested-subquery"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_convoluted</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select asdf</span>
<span class="s2">from (</span>
<span class="s2">    select asdf, qwer, /* some comment */</span>
<span class="s2">    from (select a.asdf, b.qwer, --some comment</span>
<span class="s2">          from (select asdf </span>
<span class="s2">                from table1) as a </span>
<span class="s2">            right join (select qwer </span>
<span class="s2">                        from table2) as b</span>
<span class="s2">                on a.asdf = b.asdf)</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_convoluted</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT asdf</span>
<span class="s2">FROM   (SELECT asdf,</span>
<span class="s2">               qwer /* some comment */</span>
<span class="s2">        FROM   (SELECT a.asdf,</span>
<span class="s2">                       b.qwer --some comment</span>
<span class="s2">                FROM   (SELECT asdf</span>
<span class="s2">                        FROM   table1) as a</span>
<span class="s2">                    RIGHT JOIN (SELECT qwer</span>
<span class="s2">                                FROM   table2) as b</span>
<span class="s2">                        ON a.asdf = b.asdf));&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span><span class="n">example_convoluted</span><span class="p">),</span>
    <span class="n">expected_convoluted</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf
FROM   (SELECT asdf,
               qwer /* some comment */
        FROM   (SELECT a.asdf,
                       b.qwer --some comment
                FROM   (SELECT asdf
                        FROM   table1) as a
                    RIGHT JOIN (SELECT qwer
                                FROM   table2) as b
                        ON a.asdf = b.asdf));
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">qwer</span>
<span class="sd">from table1 union select qwer,</span>
<span class="sd">asdf, asdf2 from table3</span>
<span class="sd">where asdf2 &gt;=2</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT asdf,</span>
<span class="sd">       qwer</span>
<span class="sd">FROM   table1</span>
<span class="sd">UNION</span>
<span class="sd">SELECT qwer,</span>
<span class="sd">       asdf,</span>
<span class="sd">       asdf2</span>
<span class="sd">FROM   table3</span>
<span class="sd">WHERE  asdf2 &gt;= 2;</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf,
       qwer
FROM   table1
UNION
SELECT qwer,
       asdf,
       asdf2
FROM   table3
WHERE  asdf2 &gt;= 2;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

