---

title: utils


keywords: fastai
sidebar: home_sidebar

summary: "Helper functions for SQL-text preparation"
description: "Helper functions for SQL-text preparation"
nb_path: "nbs/02_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="General-utils">General utils<a class="anchor-link" href="#General-utils"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="assert_and_print" class="doc_header"><code>assert_and_print</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L14" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>assert_and_print</code>(<strong><code>s_in</code></strong>, <strong><code>s_expected</code></strong>)</p>
</blockquote>
<p>Assert equality of <code>s_in</code> and <code>s_expected</code> and print the result of <code>s_in</code> if the assertion worked</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="s2">&quot;some string&quot;</span><span class="p">,</span> <span class="s2">&quot;some string&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>some string
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="String-formatting-functions">String formatting functions<a class="anchor-link" href="#String-formatting-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="remove_whitespaces_newline" class="doc_header"><code>remove_whitespaces_newline</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L30" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>remove_whitespaces_newline</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Remove whitespaces before and after newline in <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_whitespaces_newline</span><span class="p">(</span><span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2"> from table1 </span><span class="se">\n</span><span class="s2">where asdf = 1 </span><span class="se">\n</span><span class="s2"> group by asdf&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1</span><span class="se">\n</span><span class="s2">where asdf = 1</span><span class="se">\n</span><span class="s2">group by asdf&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf
from table1
where asdf = 1
group by asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="remove_whitespaces_comments" class="doc_header"><code>remove_whitespaces_comments</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L37" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>remove_whitespaces_comments</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Remove whitespaces before and after comment tokens in <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_whitespaces_comments</span><span class="p">(</span>
        <span class="s2">&quot;select asdf[C] from table1 [CS]where asdf = 1 [C] group by asdf&quot;</span>
    <span class="p">),</span>
    <span class="s2">&quot;select asdf[C]from table1[CS]where asdf = 1[C]group by asdf&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf[C]from table1[CS]where asdf = 1[C]group by asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="remove_redundant_whitespaces" class="doc_header"><code>remove_redundant_whitespaces</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L46" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>remove_redundant_whitespaces</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Strip and emove redundant (more than 2) whitespaces in <code>s</code> but no newlines in between</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Only whitespaces</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_redundant_whitespaces</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">some string     many whitespaces   some more&quot;</span><span class="p">),</span>
    <span class="s2">&quot;some string many whitespaces some more&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>some string many whitespaces some more
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Whitespaces and newlines</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_redundant_whitespaces</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">some string   </span><span class="se">\n</span><span class="s2">  many whitespaces</span><span class="se">\n</span><span class="s2">   </span><span class="se">\n</span><span class="s2">some more</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="s2">&quot;some string </span><span class="se">\n</span><span class="s2"> many whitespaces</span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2">some more&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>some string 
 many whitespaces
 
some more
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function to mark comments' boundaries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mark_comments" class="doc_header"><code>mark_comments</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L53" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mark_comments</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Mark end of comments -- and begin of comments /<em> </em>/ if they are in a new line with token [C]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, -- some comment</span>
<span class="sd">qwer, qwer2,</span>
<span class="sd">/* comment line */</span>
<span class="sd">qwer3,</span>
<span class="sd">qwer4 -- comment</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, -- some comment[C]</span>
<span class="sd">qwer, qwer2,</span>
<span class="sd">[CS]/* comment line */[C]</span>
<span class="sd">qwer3,</span>
<span class="sd">qwer4 -- comment[C]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
select asdf, -- some comment[C]
qwer, qwer2,
[CS]/* comment line */[C]
qwer3,
qwer4 -- comment[C]

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, -- some comment</span>
<span class="sd">qwer, qwer2, -- another comment</span>
<span class="sd">/* comment line */</span>
<span class="sd">qwer3,</span>
<span class="sd">-- another comment line</span>
<span class="sd">qwer4 -- comment</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, -- some comment[C]</span>
<span class="sd">qwer, qwer2, -- another comment[C]</span>
<span class="sd">[CS]/* comment line */[C]</span>
<span class="sd">qwer3,</span>
<span class="sd">[CS]-- another comment line[C]</span>
<span class="sd">qwer4 -- comment[C]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
select asdf, -- some comment[C]
qwer, qwer2, -- another comment[C]
[CS]/* comment line */[C]
qwer3,
[CS]-- another comment line[C]
qwer4 -- comment[C]

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace my_table as</span>
<span class="sd">/* some comment</span>
<span class="sd"> some new comment line */</span>
<span class="sd">select asdf,</span>
<span class="sd">qwer, qwer2</span>

<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>    
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace my_table as</span>
<span class="sd">[CS]/* some comment</span>
<span class="sd"> some new comment line */[C]</span>
<span class="sd">select asdf,</span>
<span class="sd">qwer, qwer2</span>

<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
create or replace my_table as
[CS]/* some comment
 some new comment line */[C]
select asdf,
qwer, qwer2

from table1

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT asdf, qwer, /* another comment */</span>
<span class="sd">qwer1, </span>
<span class="sd">/* inline comment */</span>
<span class="sd">qwer2</span>
<span class="sd">FROM table1</span>
<span class="sd">WHERE asdf=1&quot;&quot;&quot;</span>
    <span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SELECT asdf, qwer, /* another comment */[C]</span><span class="se">\n</span><span class="s2">qwer1, </span><span class="se">\n</span><span class="s2">[CS]/* inline comment */[C]</span><span class="se">\n</span><span class="s2">qwer2</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf=1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
SELECT asdf, qwer, /* another comment */[C]
qwer1, 
[CS]/* inline comment */[C]
qwer2
FROM table1
WHERE asdf=1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select a.asdf, b.qwer, -- some comment here</span>
<span class="sd">/* and here is a line comment inside select */</span>
<span class="sd">substr(c.asdf, 1, 2) as substr_asdf, </span>
<span class="sd">/* some commenT there */</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select a.asdf, b.qwer, -- some comment here[C]</span>
<span class="sd">[CS]/* and here is a line comment inside select */[C]</span>
<span class="sd">substr(c.asdf, 1, 2) as substr_asdf, </span>
<span class="sd">[CS]/* some commenT there */[C]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
select a.asdf, b.qwer, -- some comment here[C]
[CS]/* and here is a line comment inside select */[C]
substr(c.asdf, 1, 2) as substr_asdf, 
[CS]/* some commenT there */[C]

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="General-function-to-search-for-specific-keywords-ignoring-comments-and-quotes">General function to search for specific keywords ignoring comments and quotes<a class="anchor-link" href="#General-function-to-search-for-specific-keywords-ignoring-comments-and-quotes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="identify_in_sql" class="doc_header"><code>identify_in_sql</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L63" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>identify_in_sql</code>(<strong><code>kws</code></strong>, <strong><code>s</code></strong>)</p>
</blockquote>
<p>Find positions of keywords <code>kws</code> (str or list) in string <code>s</code> ignoring comment and text in quotess</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function to identify newline characters \n but not in the comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="identify_newline_chars" class="doc_header"><code>identify_newline_chars</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L157" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>identify_newline_chars</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Identify positions of newline characters in <code>s</code> ignoring comments and text in quotes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">identify_newline_chars</span><span class="p">(</span>
        <span class="s2">&quot;select asdf,</span><span class="se">\n</span><span class="s2">qwer, /* some comment </span><span class="se">\n</span><span class="s2"> with multiple lines </span><span class="se">\n</span><span class="s2">*/[C], some_field from</span><span class="se">\n</span><span class="s2"> table&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">80</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[12, 80]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function to replace newline characters \n by whitespace but not in the comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="replace_newline_chars" class="doc_header"><code>replace_newline_chars</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L162" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>replace_newline_chars</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Replace newline characters in <code>s</code> by whitespace but not in the comments</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">replace_newline_chars</span><span class="p">(</span>
        <span class="s2">&quot;select asdf,</span><span class="se">\n</span><span class="s2">qwer, /* some comment </span><span class="se">\n</span><span class="s2"> with multiple lines </span><span class="se">\n</span><span class="s2">*/[C], some_field from</span><span class="se">\n</span><span class="s2"> table&quot;</span>
    <span class="p">),</span>
    <span class="s2">&quot;select asdf, qwer, /* some comment </span><span class="se">\n</span><span class="s2"> with multiple lines </span><span class="se">\n</span><span class="s2">*/[C], some_field from  table&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf, qwer, /* some comment 
 with multiple lines 
*/[C], some_field from  table
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need a function to identify the text between SELECT and FROM. Unfortunately, this cannot be accomplished via regex because the keywords SELECT and FROM may also be written within comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="identify_select_from" class="doc_header"><code>identify_select_from</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L169" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>identify_select_from</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Identify positions of SELECT and FROM in query <code>s</code> ignoring comments and text in quotes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">identify_select_from</span><span class="p">(</span>
        <span class="s2">&quot;create or Replace Table as SeLect asdf, qwer /* some comment SELECT */[C]fRom table1&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">73</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[27, 73]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">identify_select_from</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create table my_table </span>
<span class="sd">as select asdf, </span>
<span class="sd">qwer -- some comment[C][CS]/* some comment line with SELECT */[C]from table1 where asdf = 1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">106</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[27, 106]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">identify_select_from</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create table my_table </span>
<span class="sd">as select asdf</span>
<span class="sd">from (select qwer -- some comment[C]</span>
<span class="sd">from table1)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">76</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[27, 39, 45, 76]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Having identified the positions we now can also split the query by SELECT and FROM</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_by_select_from" class="doc_header"><code>split_by_select_from</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L174" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_by_select_from</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Split query <code>s</code> by statements SELECT and FROM</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_by_select_from</span><span class="p">(</span>
        <span class="s2">&quot;create or Replace Table as SeLect asdf, qwer /* some comment SELECT */[C]fRom table1&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span>
        <span class="s2">&quot;create or Replace Table as &quot;</span><span class="p">,</span>
        <span class="s2">&quot;SeLect asdf, qwer /* some comment SELECT */[C]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fRom table1&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;create or Replace Table as &#39;, &#39;SeLect asdf, qwer /* some comment SELECT */[C]&#39;, &#39;fRom table1&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_by_select_from</span><span class="p">(</span>
        <span class="s2">&quot;SeLect asdf, qwer /* some comment SELECT */[C]fRom table1&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span>
        <span class="s2">&quot;SeLect asdf, qwer /* some comment SELECT */[C]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fRom table1&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;SeLect asdf, qwer /* some comment SELECT */[C]&#39;, &#39;fRom table1&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_by_select_from</span><span class="p">(</span>
        <span class="s2">&quot;SeLect asdf, substr(&#39;from&#39;, &#39;&#39;, qwer) as qwer5 /* some comment SELECT */[C]fRom table1&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span>
        <span class="s2">&quot;SeLect asdf, substr(&#39;from&#39;, &#39;&#39;, qwer) as qwer5 /* some comment SELECT */[C]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fRom table1&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#34;SeLect asdf, substr(&#39;from&#39;, &#39;&#39;, qwer) as qwer5 /* some comment SELECT */[C]&#34;, &#39;fRom table1&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_by_select_from</span><span class="p">(</span>
        <span class="s2">&quot;create or Replace Table as SeLect asdf, qwer /* some comment SELECT */[C]fRom (select asdf from table1)&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span>
        <span class="s2">&quot;create or Replace Table as &quot;</span><span class="p">,</span>
        <span class="s2">&quot;SeLect asdf, qwer /* some comment SELECT */[C]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fRom (&quot;</span><span class="p">,</span>
        <span class="s2">&quot;select asdf &quot;</span><span class="p">,</span>
        <span class="s2">&quot;from table1)&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;create or Replace Table as &#39;, &#39;SeLect asdf, qwer /* some comment SELECT */[C]&#39;, &#39;fRom (&#39;, &#39;select asdf &#39;, &#39;from table1)&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_whitespaces_between_symbols" class="doc_header"><code>add_whitespaces_between_symbols</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L187" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_whitespaces_between_symbols</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Add whitespaces between symbols in line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_whitespaces_between_symbols</span><span class="p">(</span>
        <span class="s2">&quot;WHERE asdf= 1 and qwer=&gt;1 or blabla =&#39;asdf&#39;&quot;</span>
    <span class="p">),</span> <span class="s2">&quot;WHERE asdf = 1 and qwer =&gt; 1 or blabla = &#39;asdf&#39;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>WHERE asdf = 1 and qwer =&gt; 1 or blabla = &#39;asdf&#39;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function to identify end of fields in SELECT. Usually this is a comma but more generally specially when using functions this strategy does not work anymore. For the sake of explanation, consider for instance</p>
<p><code>substr(asdf, 1, 2)</code></p>
<p>In that case, we would like to not add a newline for each comma.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="identify_end_of_fields" class="doc_header"><code>identify_end_of_fields</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L195" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>identify_end_of_fields</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Identify end of fields in query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">identify_end_of_fields</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, substr(asdf, 1, 2) as qwer, concat(substr(asdf, 1, 2), substr(asdf, 3, 2)) as qwer2, asdf5</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">),</span> 
    <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">97</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[12, 40, 97]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>More advanced with comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">identify_end_of_fields</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, /* Some commnent */[C]qwerty, substr(asdf, 1, 2) as qwer, -- Some comment[C] asdf5</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">),</span> <span class="p">[</span><span class="mi">42</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[42]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">identify_end_of_fields</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, [CS]/* Some commnent */[C]qwerty, substr(asdf, 1, 2) as qwer, -- Some comment[C] asdf5</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">),</span> <span class="p">[</span><span class="mi">46</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[46]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Even more tricky with a comma inside comment</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">identify_end_of_fields</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, /* Some, commnent */[C]qwerty, substr(asdf, 1, 2) as qwer, -- Some, comment[C] asdf5</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">),</span> <span class="p">[</span><span class="mi">43</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[43]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Having the end of fields positions, we need function to add a newline and proper indentation</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_newline_indentation" class="doc_header"><code>add_newline_indentation</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L214" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_newline_indentation</code>(<strong><code>s</code></strong>, <strong><code>indentation</code></strong>)</p>
</blockquote>
<p>Add newline and indentation for end of fields in query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_newline_indentation</span><span class="p">(</span>
        <span class="s2">&quot;select asdf, substr(asdf, 1, 2) as qwer, concat(substr(asdf, 1, 2), substr(asdf, 3, 2)) as qwer2, asdf5&quot;</span><span class="p">,</span>
        <span class="mi">7</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       substr(asdf, 1, 2) as qwer,</span>
<span class="sd">       concat(substr(asdf, 1, 2), substr(asdf, 3, 2)) as qwer2,</span>
<span class="sd">       asdf5</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       substr(asdf, 1, 2) as qwer,
       concat(substr(asdf, 1, 2), substr(asdf, 3, 2)) as qwer2,
       asdf5
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_newline_indentation</span><span class="p">(</span>
        <span class="s2">&quot;select asdf, substr(asdf, 1, 2) as qwer, lead(qwer) OVER (partition by asdf order by qwer), asdf2&quot;</span><span class="p">,</span>
        <span class="mi">7</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       substr(asdf, 1, 2) as qwer,</span>
<span class="sd">       lead(qwer) OVER (partition by asdf order by qwer),</span>
<span class="sd">       asdf2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       substr(asdf, 1, 2) as qwer,
       lead(qwer) OVER (partition by asdf order by qwer),
       asdf2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_newline_indentation</span><span class="p">(</span>
        <span class="s2">&quot;select asdf, replace(&#39;,&#39;, &#39;&#39;, asdf) as qwer, lead(qwer) OVER (partition by asdf order by qwer), asdf2&quot;</span><span class="p">,</span>
        <span class="mi">7</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       replace(&#39;,&#39;, &#39;&#39;, asdf) as qwer,</span>
<span class="sd">       lead(qwer) OVER (partition by asdf order by qwer),</span>
<span class="sd">       asdf2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
       replace(&#39;,&#39;, &#39;&#39;, asdf) as qwer,
       lead(qwer) OVER (partition by asdf order by qwer),
       asdf2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Helper-functions-to-handle-subqueries">Helper functions to handle subqueries<a class="anchor-link" href="#Helper-functions-to-handle-subqueries"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_outer_subquery" class="doc_header"><code>extract_outer_subquery</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L232" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_outer_subquery</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Extract outer subquery in query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="p">(</span>
    <span class="n">extract_outer_subquery</span><span class="p">(</span>
        <span class="s2">&quot;() () (</span><span class="se">\n</span><span class="s2">SELECT () (</span><span class="se">\n</span><span class="s2">SELECT ())) ()&quot;</span>
    <span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_subquery" class="doc_header"><code>format_subquery</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L258" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_subquery</code>(<strong><code>s</code></strong>, <strong><code>previous_s</code></strong>)</p>
</blockquote>
<p>Format subquery in line <code>s</code> based on indentation on <code>previous_s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function to check whether string contains a query</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="check_sql_query" class="doc_header"><code>check_sql_query</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L284" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>check_sql_query</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Checks whether <code>s</code> is a SQL query</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">--- Table 1---</span>
<span class="s2">creaTe or replace table my_table as</span>
<span class="s2">select asdf</span>
<span class="s2">from table</span>
<span class="s2">where asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">--- Table 1---</span>
<span class="s2">creaTe or replace view my_table as</span>
<span class="s2">select asdf</span>
<span class="s2">from table</span>
<span class="s2">where asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT qwer, asdf</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;use database my_database;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace task my_task as</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace task my_task as</span>
<span class="s2">create or replace table as</span>
<span class="s2">select asdf</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">use schema my_schema;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Marker to not format queries specified by the user</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="check_skip_marker" class="doc_header"><code>check_skip_marker</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L290" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>check_skip_marker</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Checks whether user set marker /<em>skip-formatter</em>/ to not format query</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">check_skip_marker</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf,</span>
<span class="s2"> qwer,</span>
<span class="s2"> /*skip-formatter*/</span>
<span class="s2"> asdf2</span>
<span class="s2">FRoM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">check_skip_marker</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf,</span>
<span class="s2"> qwer,</span>
<span class="s2"> asdf2</span>
<span class="s2">FRoM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function to split by queries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="identify_semicolon" class="doc_header"><code>identify_semicolon</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L295" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>identify_semicolon</code>(<strong><code>s</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">identify_semicolon</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">use database my_database; -- ; ; ;;</span>
<span class="sd">use schema my_schema; /* -- ; */</span>

<span class="sd">create or replace table my_table as</span>
<span class="sd">select asdf, qwer, /* ;; -- ; */</span>
<span class="sd">replace(&#39;&quot;&quot;;&#39;, &quot;&#39;;&#39;&quot;, asdf2) as asdf5</span>
<span class="sd">qwer2 from -- ;</span>
<span class="sd">table2;</span>

<span class="sd">use schema_another_schema;</span>
<span class="sd">&quot;&quot;&quot;</span>   
    <span class="p">),</span>
    <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">228</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[25, 57, 200, 228]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_by_semicolon" class="doc_header"><code>split_by_semicolon</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L299" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_by_semicolon</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Split string <code>s</code> by semicolon but not between parenthesis or in comments</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_by_semicolon</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">use database my_database; -- ; ; ;;</span>
<span class="sd">use schema my_schema; /* -- ; */</span>

<span class="sd">create or replace table my_table as</span>
<span class="sd">select asdf, qwer, /* ;; -- ; */</span>
<span class="sd">replace(&#39;&quot;&quot;;&#39;, &quot;&#39;;&#39;&quot;, asdf2) as asdf5</span>
<span class="sd">qwer2 from -- ;</span>
<span class="sd">table2;</span>

<span class="sd">use schema_another_schema;</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">use database my_database&quot;</span><span class="p">,</span>
        <span class="s2">&quot; -- ; ; ;;</span><span class="se">\n</span><span class="s2">use schema my_schema&quot;</span><span class="p">,</span>
        <span class="sd">&quot;&quot;&quot; /* -- ; */\n\ncreate or replace table my_table as\nselect asdf, qwer, /* ;; -- ; */\nreplace(\&#39;&quot;&quot;;\&#39;, &quot;\&#39;;\&#39;&quot;, asdf2) as asdf5\nqwer2 from -- ;\ntable2&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">use schema_another_schema&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;\nuse database my_database&#39;, &#39; -- ; ; ;;\nuse schema my_schema&#39;, &#39; /* -- ; */\n\ncreate or replace table my_table as\nselect asdf, qwer, /* ;; -- ; */\nreplace(\&#39;&#34;&#34;;\&#39;, &#34;\&#39;;\&#39;&#34;, asdf2) as asdf5\nqwer2 from -- ;\ntable2&#39;, &#39;\n\nuse schema_another_schema&#39;, &#39;\n&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function to identify CREATE keyword. This will be helpful to allow for basic validation. If the keyword CREATE appears twice in the query, then something went wrong. Most probably, semicolon was forgotten</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="identify_create" class="doc_header"><code>identify_create</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L317" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>identify_create</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Identify positions of CREATE keyword</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">identify_create</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">cReate or Replace table my_table as</span>
<span class="sd">select asdf, qwer</span>
<span class="sd">from table1</span>

<span class="sd">create table qwerty as</span>
<span class="sd">select field, field2</span>
<span class="sd">from table2;</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">68</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[1, 68]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="count_lines" class="doc_header"><code>count_lines</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L322" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>count_lines</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Count the number of lines in <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">count_lines</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">cReate or Replace table my_table as</span>
<span class="sd">select asdf, qwer</span>
<span class="sd">from table1</span>

<span class="sd">create table qwerty as</span>
<span class="sd">select field, field2</span>
<span class="sd">from table2;</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="mi">8</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>8
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_line_number" class="doc_header"><code>find_line_number</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L327" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_line_number</code>(<strong><code>s</code></strong>, <strong><code>positions</code></strong>)</p>
</blockquote>
<p>Find line number in <code>s</code> out of <code>positions</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">find_line_number</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">cReate or Replace table my_table as</span>
<span class="sd">select asdf, qwer</span>
<span class="sd">from table1</span>

<span class="sd">create table qwerty as</span>
<span class="sd">select field, field2</span>
<span class="sd">from table2;</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">68</span><span class="p">]),</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[2, 6]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

