---

title: utils


keywords: fastai
sidebar: home_sidebar

summary: "Helper functions for SQL-text preparation"
description: "Helper functions for SQL-text preparation"
nb_path: "nbs/02_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="General-utils">General utils<a class="anchor-link" href="#General-utils"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="assert_and_print" class="doc_header"><code>assert_and_print</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L14" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>assert_and_print</code>(<strong><code>s_in</code></strong>, <strong><code>s_expected</code></strong>)</p>
</blockquote>
<p>Assert equality of <code>s_in</code> and <code>s_expected</code> and print the result of <code>s_in</code> if the assertion worked</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="s2">&quot;some string&quot;</span><span class="p">,</span> <span class="s2">&quot;some string&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Removing-redundant-whitespaces">Removing redundant whitespaces<a class="anchor-link" href="#Removing-redundant-whitespaces"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="remove_whitespaces_newline" class="doc_header"><code>remove_whitespaces_newline</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L30" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>remove_whitespaces_newline</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Remove whitespaces before and after newline in <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_whitespaces_newline</span><span class="p">(</span><span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2"> from table1 </span><span class="se">\n</span><span class="s2">where asdf = 1 </span><span class="se">\n</span><span class="s2"> group by asdf&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select asdf</span><span class="se">\n</span><span class="s2">from table1</span><span class="se">\n</span><span class="s2">where asdf = 1</span><span class="se">\n</span><span class="s2">group by asdf&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="remove_whitespaces_comments" class="doc_header"><code>remove_whitespaces_comments</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L37" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>remove_whitespaces_comments</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Remove whitespaces before and after comment tokens in <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_whitespaces_comments</span><span class="p">(</span>
        <span class="s2">&quot;select asdf[C] from table1 [CS]where asdf = 1 [C] group by asdf&quot;</span>
    <span class="p">),</span>
    <span class="s2">&quot;select asdf[C]from table1[CS]where asdf = 1[C]group by asdf&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_whitespaces_comments</span><span class="p">(</span>
        <span class="s2">&quot;select asdf[C][CS]/* asdf [CI]  */[C] from table1 [CS]where asdf = 1 [C] group by asdf&quot;</span>
    <span class="p">),</span>
    <span class="s2">&quot;select asdf[C][CS]/* asdf[CI]*/[C]from table1[CS]where asdf = 1[C]group by asdf&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="remove_redundant_whitespaces" class="doc_header"><code>remove_redundant_whitespaces</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L48" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>remove_redundant_whitespaces</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Strip and remove redundant (more than 2) whitespaces in <code>s</code> but no newlines in between</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Only whitespaces</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_redundant_whitespaces</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">some string     many whitespaces   some more&quot;</span><span class="p">),</span>
    <span class="s2">&quot;some string many whitespaces some more&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Whitespaces and newlines</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">remove_redundant_whitespaces</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">some string   </span><span class="se">\n</span><span class="s2">  many whitespaces</span><span class="se">\n</span><span class="s2">   </span><span class="se">\n</span><span class="s2">some more</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="s2">&quot;some string </span><span class="se">\n</span><span class="s2"> many whitespaces</span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2">some more&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Add-missing-whitespaces-between-symbols">Add missing whitespaces between symbols<a class="anchor-link" href="#Add-missing-whitespaces-between-symbols"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_whitespaces_between_symbols" class="doc_header"><code>add_whitespaces_between_symbols</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L55" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_whitespaces_between_symbols</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Add whitespaces between symbols in line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_whitespaces_between_symbols</span><span class="p">(</span>
        <span class="s2">&quot;WHERE asdf= 1 and qwer=&gt;1 or blabla =&#39;asdf&#39;&quot;</span>
    <span class="p">),</span> <span class="s2">&quot;WHERE asdf = 1 and qwer =&gt; 1 or blabla = &#39;asdf&#39;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Mark-comments-with-special-tokens-[C]-(end-of-comment),-[CS]-(start-of-comment-in-new-line)-and-[CI]-(newline-in-multiline-comment)">Mark comments with special tokens <code>[C]</code> (end of comment), <code>[CS]</code> (start of comment in new line) and <code>[CI]</code> (newline in multiline comment)<a class="anchor-link" href="#Mark-comments-with-special-tokens-[C]-(end-of-comment),-[CS]-(start-of-comment-in-new-line)-and-[CI]-(newline-in-multiline-comment)"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mark_ci_comments" class="doc_header"><code>mark_ci_comments</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L63" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mark_ci_comments</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Replace new lines in multiline comments by special token [CI]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_ci_comments</span><span class="p">(</span><span class="s2">&quot;select /* asdf </span><span class="se">\n</span><span class="s2"> qwer */&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select /* asdf [CI] qwer */&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_ci_comments</span><span class="p">(</span><span class="s2">&quot;select /* asdf </span><span class="se">\n</span><span class="s2"> qwe </span><span class="se">\n</span><span class="s2"> rqwer */&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select /* asdf [CI] qwe [CI] rqwer */&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mark_comments" class="doc_header"><code>mark_comments</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L153" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mark_comments</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Mark end of comments -- and begin of comments /<em> </em>/ if they are in a new line with token [C]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, -- some comment</span>
<span class="sd">qwer, qwer2,</span>
<span class="sd">/* comment line */</span>
<span class="sd">qwer3,</span>
<span class="sd">qwer4 -- comment</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, -- some comment[C]</span>
<span class="sd">qwer, qwer2,</span>
<span class="sd">[CS]/* comment line */[C]</span>
<span class="sd">qwer3,</span>
<span class="sd">qwer4 -- comment[C]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, -- some comment</span>
<span class="sd">qwer, qwer2, -- another comment</span>
<span class="sd">/* comment line */</span>
<span class="sd">qwer3,</span>
<span class="sd">-- another comment line</span>
<span class="sd">qwer4 -- comment</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, -- some comment[C]</span>
<span class="sd">qwer, qwer2, -- another comment[C]</span>
<span class="sd">[CS]/* comment line */[C]</span>
<span class="sd">qwer3,</span>
<span class="sd">[CS]-- another comment line[C]</span>
<span class="sd">qwer4 -- comment[C]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace my_table as</span>
<span class="sd">/* some comment</span>
<span class="sd"> some new comment line */</span>
<span class="sd">select asdf,</span>
<span class="sd">qwer, qwer2</span>

<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>    
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace my_table as</span>
<span class="sd">[CS]/* some comment[CI] some new comment line */[C]</span>
<span class="sd">select asdf,</span>
<span class="sd">qwer, qwer2</span>

<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT asdf, qwer, /* another comment */</span>
<span class="sd">qwer1, </span>
<span class="sd">/* inline comment */</span>
<span class="sd">qwer2</span>
<span class="sd">FROM table1</span>
<span class="sd">WHERE asdf=1&quot;&quot;&quot;</span>
    <span class="p">),</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SELECT asdf, qwer, /* another comment */[C]</span><span class="se">\n</span><span class="s2">qwer1, </span><span class="se">\n</span><span class="s2">[CS]/* inline comment */[C]</span><span class="se">\n</span><span class="s2">qwer2</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf=1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select a.asdf, b.qwer, -- some comment here</span>
<span class="sd">/* and here is a line comment inside select */</span>
<span class="sd">substr(c.asdf, 1, 2) as substr_asdf, </span>
<span class="sd">/* some commenT there */</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select a.asdf, b.qwer, -- some comment here[C]</span>
<span class="sd">[CS]/* and here is a line comment inside select */[C]</span>
<span class="sd">substr(c.asdf, 1, 2) as substr_asdf, </span>
<span class="sd">[CS]/* some commenT there */[C]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">/* multi line</span>
<span class="sd">comment */</span>
<span class="sd">select a.asdf, b.qwer, -- some comment here</span>
<span class="sd">/* and here is a line comment inside select */</span>
<span class="sd">substr(c.asdf, 1, 2) as substr_asdf, </span>
<span class="sd">/* some commenT </span>
<span class="sd">there */</span>
<span class="sd">case when a.asdf= 1 then &#39;b&#39; /* here a case comment */</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">[CS]/* multi line[CI]comment */[C]</span>
<span class="sd">select a.asdf, b.qwer, -- some comment here[C]</span>
<span class="sd">[CS]/* and here is a line comment inside select */[C]</span>
<span class="sd">substr(c.asdf, 1, 2) as substr_asdf, </span>
<span class="sd">[CS]/* some commenT [CI]there */[C]</span>
<span class="sd">case when a.asdf= 1 then &#39;b&#39; /* here a case comment */[C]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">mark_comments</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select a.asdf, b.qwer, -- some comment here</span>
<span class="sd">/* and here is a line comment inside select */</span>
<span class="sd">/* some commenT there */</span>
<span class="sd">case when a.asdf= 1 then &#39;b&#39; /* here a case comment */</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select a.asdf, b.qwer, -- some comment here[C]</span>
<span class="sd">[CS]/* and here is a line comment inside select */[C]</span>
<span class="sd">[CS]/* some commenT there */[C]</span>
<span class="sd">case when a.asdf= 1 then &#39;b&#39; /* here a case comment */[C]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-positions-of-specific-keywords-in-query-ignoring-comments">Get positions of specific keywords in query ignoring comments<a class="anchor-link" href="#Get-positions-of-specific-keywords-in-query-ignoring-comments"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="identify_in_sql" class="doc_header"><code>identify_in_sql</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L164" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>identify_in_sql</code>(<strong><code>kws</code></strong>, <strong><code>s</code></strong>)</p>
</blockquote>
<p>Find positions of keywords <code>kws</code> (str or list) in string <code>s</code> ignoring comment and text in quotess</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Splitting-functions">Splitting functions<a class="anchor-link" href="#Splitting-functions"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Split-query-into-a-comment-and-a-non-comment-region">Split query into a comment and a non-comment region<a class="anchor-link" href="#Split-query-into-a-comment-and-a-non-comment-region"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_comment_non_comment" class="doc_header"><code>split_comment_non_comment</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L258" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_comment_non_comment</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Split query into comment (True) and non-comment (False) components.</p>
<p>Return a dict with keys "string" and "comment" in (True, False)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_comment_non_comment</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create table my_table as -- some table</span>
<span class="sd">select asdf, /* some comment */ qwer</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">create table my_table as &quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;-- some table&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">select asdf, &quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;/* some comment */&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot; qwer</span><span class="se">\n</span><span class="s2">from table1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>        
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Split-query-into-the-combinations-comment,-non-comment,-select-and-non-select">Split query into the combinations comment, non-comment, select and non-select<a class="anchor-link" href="#Split-query-into-the-combinations-comment,-non-comment,-select-and-non-select"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_comment_select" class="doc_header"><code>split_comment_select</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L320" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_comment_select</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Split query into comment, non-comment, select and non-select components.</p>
<p>Return a dict with keys "string", "comment" in (True, False) and "select" in (True, False)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_comment_select</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create table my_table as -- some table</span>
<span class="sd">seLect asdf, /* some comment */ qwer</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">create table my_table as &quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;-- some table&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>        
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;seLect asdf, &quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;/* some comment */&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot; qwer</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;from table1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>        
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Split-individual-queries-based-on-semicolon">Split individual queries based on semicolon<a class="anchor-link" href="#Split-individual-queries-based-on-semicolon"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_by_semicolon" class="doc_header"><code>split_by_semicolon</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L398" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_by_semicolon</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Split string <code>s</code> by semicolon but not between parenthesis or in comments</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_by_semicolon</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">use database my_database; -- ; ; ;;</span>
<span class="sd">use schema my_schema; /* -- ; */</span>

<span class="sd">create or replace table my_table as</span>
<span class="sd">select asdf, qwer, /* ;; -- ; */</span>
<span class="sd">replace(&#39;&quot;&quot;;&#39;, &quot;&#39;;&#39;&quot;, asdf2) as asdf5</span>
<span class="sd">qwer2 from -- ;</span>
<span class="sd">table2;</span>

<span class="sd">use schema_another_schema;</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
    <span class="p">[</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">use database my_database&quot;</span><span class="p">,</span>
        <span class="s2">&quot; -- ; ; ;;</span><span class="se">\n</span><span class="s2">use schema my_schema&quot;</span><span class="p">,</span>
        <span class="sd">&quot;&quot;&quot; /* -- ; */\n\ncreate or replace table my_table as\nselect asdf, qwer, /* ;; -- ; */\nreplace(\&#39;&quot;&quot;;\&#39;, &quot;\&#39;;\&#39;&quot;, asdf2) as asdf5\nqwer2 from -- ;\ntable2&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">use schema_another_schema&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="replace_newline_chars" class="doc_header"><code>replace_newline_chars</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L416" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>replace_newline_chars</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Replace newline characters in <code>s</code> by whitespace but not in the comments</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">replace_newline_chars</span><span class="p">(</span>
        <span class="s2">&quot;select asdf,</span><span class="se">\n</span><span class="s2">qwer, /* some comment </span><span class="se">\n</span><span class="s2"> with multiple lines </span><span class="se">\n</span><span class="s2">*/[C], some_field from</span><span class="se">\n</span><span class="s2"> table&quot;</span>
    <span class="p">),</span>
    <span class="s2">&quot;select asdf, qwer, /* some comment </span><span class="se">\n</span><span class="s2"> with multiple lines </span><span class="se">\n</span><span class="s2">*/[C], some_field from  table&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function to identify end of fields in SELECT. Usually this is a comma but more generally specially when using functions this strategy does not work anymore. For the sake of explanation, consider for instance</p>
<p><code>substr(asdf, 1, 2)</code></p>
<p>In that case, we would like to not add a newline for each comma.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="identify_end_of_fields" class="doc_header"><code>identify_end_of_fields</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L423" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>identify_end_of_fields</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Identify end of fields in query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">identify_end_of_fields</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, substr(asdf, 1, 2) as qwer, concat(substr(asdf, 1, 2), substr(asdf, 3, 2)) as qwer2, asdf5</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">),</span> 
    <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">97</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>More advanced with comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">identify_end_of_fields</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, /* Some commnent */[C]qwerty, substr(asdf, 1, 2) as qwer, -- Some comment[C] asdf5</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">),</span> <span class="p">[</span><span class="mi">42</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">identify_end_of_fields</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, [CS]/* Some commnent */[C]qwerty, substr(asdf, 1, 2) as qwer, -- Some comment[C] asdf5</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">),</span> <span class="p">[</span><span class="mi">46</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Even more tricky with a comma inside comment</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">identify_end_of_fields</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, /* Some, commnent */[C]qwerty, substr(asdf, 1, 2) as qwer, -- Some, comment[C] asdf5</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">),</span> <span class="p">[</span><span class="mi">43</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Having the end of fields positions, we need function to add a newline and proper indentation</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_newline_indentation" class="doc_header"><code>add_newline_indentation</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L442" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_newline_indentation</code>(<strong><code>s</code></strong>, <strong><code>indentation</code></strong>)</p>
</blockquote>
<p>Add newline and indentation for end of fields in query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_newline_indentation</span><span class="p">(</span>
        <span class="s2">&quot;select asdf, substr(asdf, 1, 2) as qwer, concat(substr(asdf, 1, 2), substr(asdf, 3, 2)) as qwer2, asdf5&quot;</span><span class="p">,</span>
        <span class="mi">7</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       substr(asdf, 1, 2) as qwer,</span>
<span class="sd">       concat(substr(asdf, 1, 2), substr(asdf, 3, 2)) as qwer2,</span>
<span class="sd">       asdf5</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_newline_indentation</span><span class="p">(</span>
        <span class="s2">&quot;select asdf, substr(asdf, 1, 2) as qwer, lead(qwer) OVER (partition by asdf order by qwer), asdf2&quot;</span><span class="p">,</span>
        <span class="mi">7</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       substr(asdf, 1, 2) as qwer,</span>
<span class="sd">       lead(qwer) OVER (partition by asdf order by qwer),</span>
<span class="sd">       asdf2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_newline_indentation</span><span class="p">(</span>
        <span class="s2">&quot;select asdf, replace(&#39;,&#39;, &#39;&#39;, asdf) as qwer, lead(qwer) OVER (partition by asdf order by qwer), asdf2&quot;</span><span class="p">,</span>
        <span class="mi">7</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">       replace(&#39;,&#39;, &#39;&#39;, asdf) as qwer,</span>
<span class="sd">       lead(qwer) OVER (partition by asdf order by qwer),</span>
<span class="sd">       asdf2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Handling-subqueries">Handling subqueries<a class="anchor-link" href="#Handling-subqueries"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_outer_subquery" class="doc_header"><code>extract_outer_subquery</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L460" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_outer_subquery</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Extract outer subquery in query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="p">(</span>
    <span class="n">extract_outer_subquery</span><span class="p">(</span>
        <span class="s2">&quot;() () (</span><span class="se">\n</span><span class="s2">SELECT () (</span><span class="se">\n</span><span class="s2">SELECT ())) ()&quot;</span>
    <span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_subquery" class="doc_header"><code>format_subquery</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L486" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_subquery</code>(<strong><code>s</code></strong>, <strong><code>previous_s</code></strong>)</p>
</blockquote>
<p>Format subquery in line <code>s</code> based on indentation on <code>previous_s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query-identification">Query identification<a class="anchor-link" href="#Query-identification"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="check_sql_query" class="doc_header"><code>check_sql_query</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L512" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>check_sql_query</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Checks whether <code>s</code> is a SQL query based on match of CREATE TABLE / VIEW or SELECT</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">--- Table 1---</span>
<span class="s2">creaTe or replace table my_table as</span>
<span class="s2">select asdf</span>
<span class="s2">from table</span>
<span class="s2">where asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">--- Table 1---</span>
<span class="s2">creaTe or replace view my_table as</span>
<span class="s2">select asdf</span>
<span class="s2">from table</span>
<span class="s2">where asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT qwer, asdf</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;use database my_database;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace task my_task as</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace task my_task as</span>
<span class="s2">create or replace table as</span>
<span class="s2">select asdf</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">check_sql_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">use schema my_schema;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Marker-to-not-format-queries-specified-by-the-user">Marker to not format queries specified by the user<a class="anchor-link" href="#Marker-to-not-format-queries-specified-by-the-user"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="check_skip_marker" class="doc_header"><code>check_skip_marker</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L518" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>check_skip_marker</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Checks whether user set marker /<em>skip-formatter</em>/ to not format query</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">check_skip_marker</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf,</span>
<span class="s2"> qwer,</span>
<span class="s2"> /*skip-formatter*/</span>
<span class="s2"> asdf2</span>
<span class="s2">FRoM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="n">check_skip_marker</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf,</span>
<span class="s2"> qwer,</span>
<span class="s2"> asdf2</span>
<span class="s2">FRoM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Check-lines-were-CREATE-..-TABLE-/-VIEW-appear">Check lines were CREATE .. TABLE / VIEW appear<a class="anchor-link" href="#Check-lines-were-CREATE-..-TABLE-/-VIEW-appear"> </a></h4><p>This will be used for query split validation. After splitting by individual queries, if the statement CREATE .. TABLE / VIEW appears twice then the user most probably has forgotten a semicolon</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="identify_create_table_view" class="doc_header"><code>identify_create_table_view</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L523" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>identify_create_table_view</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Identify positions of CREATE .. TABLE / VIEW statements</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">identify_create_table_view</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">cReate or Replace table my_table as</span>
<span class="sd">select asdf, qwer</span>
<span class="sd">from table1</span>

<span class="sd">create table qwerty as</span>
<span class="sd">select field, field2</span>
<span class="sd">from table2;</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="count_lines" class="doc_header"><code>count_lines</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L536" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>count_lines</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Count the number of lines in <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">count_lines</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">cReate or Replace table my_table as</span>
<span class="sd">select asdf, qwer</span>
<span class="sd">from table1</span>

<span class="sd">create table qwerty as</span>
<span class="sd">select field, field2</span>
<span class="sd">from table2;</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="mi">8</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_line_number" class="doc_header"><code>find_line_number</code><a href="https://github.com/PabloRMira/sql_formatter/tree/master/sql_formatter/utils.py#L541" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_line_number</code>(<strong><code>s</code></strong>, <strong><code>positions</code></strong>)</p>
</blockquote>
<p>Find line number in <code>s</code> out of <code>positions</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">find_line_number</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">cReate or Replace table my_table as</span>
<span class="sd">select asdf, qwer</span>
<span class="sd">from table1</span>

<span class="sd">create table qwerty as</span>
<span class="sd">select field, field2</span>
<span class="sd">from table2;</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">68</span><span class="p">]),</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

